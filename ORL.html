
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dance Studio CRM | –ü–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary: #8a2be2; --primary-dark: #7b1fa2; --secondary: #ff4081;
            --light: #f5f5f5; --dark: #333; --gray: #666; --light-gray: #eee;
            --success: #4caf50; --warning: #ff9800; --danger: #f44336;
            --dance1: #9c27b0; --dance2: #3f51b5; --dance3: #00bcd4;
            --info: #17a2b8;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--light); color: var(--dark); }
        
        .container { display: flex; min-height: 100vh; }
        .sidebar { width: 250px; background: var(--dark); color: white; padding: 20px 0; position: fixed; height: 100vh; overflow-y: auto; }
        .content { flex: 1; margin-left: 250px; padding: 20px; }
        
        .logo { padding: 0 20px 30px; border-bottom: 1px solid var(--gray); display: flex; align-items: center; gap: 10px; }
        .logo i { font-size: 28px; color: var(--primary); }
        .nav-menu { list-style: none; margin-top: 20px; }
        .nav-menu li { padding: 15px 20px; cursor: pointer; display: flex; align-items: center; gap: 10px; transition: background 0.3s; }
        .nav-menu li:hover { background: var(--gray); }
        .nav-menu li.active { background: var(--primary); border-left: 4px solid var(--secondary); }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        h1 { margin-bottom: 20px; color: var(--primary); display: flex; align-items: center; gap: 10px; }
        h2 { margin: 20px 0 15px; color: var(--dark); }
        h3 { margin: 15px 0 10px; color: var(--gray); font-size: 16px; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px; }
        
        /* –ö–∞—Ä—Ç–æ—á–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center; }
        .stat-card h3 { color: var(--gray); margin-bottom: 10px; font-size: 14px; }
        .stat-card p { font-size: 32px; font-weight: bold; color: var(--primary); }
        
        /* –¢–∞–±–ª–∏—Ü—ã */
        .table-container { background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); overflow-x: auto; margin-top: 20px; }
        table { width: 100%; border-collapse: collapse; font-size: 14px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid var(--light-gray); }
        th { background: var(--light); font-weight: 600; color: var(--dark); position: sticky; top: 0; }
        tr:hover { background: #f9f9f9; }
        
        /* –ö–Ω–æ–ø–∫–∏ */
        .btn { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; transition: background 0.3s; display: inline-flex; align-items: center; gap: 5px; font-size: 14px; }
        .btn:hover { background: var(--primary-dark); }
        .btn-sm { padding: 5px 10px; font-size: 12px; }
        .btn-success { background: var(--success); }
        .btn-warning { background: var(--warning); }
        .btn-danger { background: var(--danger); }
        .btn-info { background: var(--info); }
        
        /* –§–æ—Ä–º—ã */
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 500; }
        .form-group input, .form-group select, .form-group textarea { 
            width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 5px; 
            font-size: 14px; transition: border 0.3s;
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { 
            outline: none; border-color: var(--primary); 
        }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .form-actions { display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; }
        
        /* –°—Ç–∞—Ç—É—Å—ã */
        .status { padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 500; display: inline-block; }
        .status.active { background: #d4edda; color: #155724; }
        .status.pending { background: #fff3cd; color: #856404; }
        .status.completed { background: #d1ecf1; color: #0c5460; }
        .status.cancelled { background: #f8d7da; color: #721c24; }
        .status.inactive { background: #e9ecef; color: #495057; }
        
        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); }
        .modal-content { background: white; margin: 5% auto; padding: 20px; border-radius: 10px; width: 90%; max-width: 600px; max-height: 90vh; overflow-y: auto; position: relative; }
        .close { position: absolute; right: 20px; top: 10px; font-size: 28px; cursor: pointer; color: var(--gray); }
        .close:hover { color: var(--dark); }
        
        /* –ö–∞–ª–µ–Ω–¥–∞—Ä—å */
        .calendar-container { background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .calendar-nav { display: flex; gap: 10px; align-items: center; }
        .calendar-nav-btn { background: var(--light); border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .calendar-nav-btn:hover { background: var(--light-gray); }
        
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background: var(--light-gray); border: 1px solid var(--light-gray); }
        .calendar-day-header { background: var(--light); padding: 15px 10px; text-align: center; font-weight: 600; color: var(--dark); border-bottom: 2px solid var(--primary); }
        .calendar-day { background: white; min-height: 120px; padding: 10px; position: relative; border: 1px solid var(--light-gray); transition: all 0.3s; }
        .calendar-day:hover { background: #f9f9f9; }
        .calendar-day.today { background: #e8f5e9; border-color: var(--success); }
        .calendar-day.other-month { background: #fafafa; color: #999; }
        .calendar-day-number { position: absolute; top: 5px; right: 5px; font-size: 14px; font-weight: 600; color: var(--gray); }
        .calendar-day.today .calendar-day-number { background: var(--success); color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        
        .calendar-event { background: var(--dance1); color: white; padding: 4px 8px; border-radius: 4px; margin-top: 5px; font-size: 12px; cursor: pointer; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }
        .calendar-event:hover { opacity: 0.9; }
        
        /* –§–∏–ª—å—Ç—Ä—ã */
        .filters { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .filters input, .filters select { padding: 8px 12px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px; min-width: 200px; }
        
        /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        
        /* –ê–≤–∞—Ç–∞—Ä–∫–∏ */
        .avatar { width: 40px; height: 40px; border-radius: 50%; background: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        
        /* –î–µ–π—Å—Ç–≤–∏—è */
        .action-buttons { display: flex; gap: 5px; }
        .action-btn { padding: 5px 10px; border: none; border-radius: 3px; cursor: pointer; font-size: 12px; }
        .action-btn.edit { background: var(--info); color: white; }
        .action-btn.delete { background: var(--danger); color: white; }
        .action-btn.view { background: var(--success); color: white; }
        
        /* –ü–æ–∏—Å–∫ */
        .search-box { margin-bottom: 20px; }
        .search-box input { width: 100%; padding: 10px 15px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px; }
        
        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notification { position: fixed; top: 20px; right: 20px; padding: 15px 20px; background: var(--success); color: white; border-radius: 5px; z-index: 1001; display: none; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .notification.error { background: var(--danger); }
        .notification.warning { background: var(--warning); }
        .notification.info { background: var(--info); }
        
        /* –ó–∞–≥—Ä—É–∑–∫–∞ */
        .loading { text-align: center; padding: 40px; color: var(--gray); }
        .loading::after { content: '...'; animation: dots 1.5s infinite; }
        @keyframes dots { 
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
        
        /* –ü—É—Å—Ç—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è */
        .empty-state { text-align: center; padding: 40px 20px; color: var(--gray); }
        .empty-state i { font-size: 48px; margin-bottom: 20px; opacity: 0.5; }
        
        /* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –≤–∫–ª–∞–¥–æ–∫ */
        .tabs { display: flex; border-bottom: 1px solid #ddd; margin-bottom: 20px; }
        .tab { padding: 10px 20px; cursor: pointer; border-bottom: 2px solid transparent; }
        .tab.active { border-bottom-color: var(--primary); color: var(--primary); font-weight: 600; }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .sidebar { width: 70px; }
            .sidebar .logo h2, .sidebar .nav-menu li span { display: none; }
            .content { margin-left: 70px; padding: 10px; }
            .stats-grid { grid-template-columns: 1fr; }
            .form-row { grid-template-columns: 1fr; }
            .filters input, .filters select { min-width: 100%; }
            .section-header { flex-direction: column; align-items: flex-start; }
            .calendar-day { min-height: 80px; padding: 5px; }
        }
    </style>
</head>
<body>
    <!-- –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -->
    <div class="container" id="app-container">
        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <nav class="sidebar">
            <div class="logo">
                <span style="font-size: 28px;">üíÉ</span>
                <h2 id="studio-name-header">DanceCRM</h2>
            </div>
            <div style="padding: 20px; color: var(--light-gray); font-size: 12px;">
                <div id="current-user">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</div>
                <button class="btn btn-sm" style="margin-top: 10px; width: 100%; background: var(--info);" onclick="showSettingsModal()">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
            </div>
            <ul class="nav-menu">
                <li class="active" data-tab="dashboard"><span>üìä</span> <span>–î–∞—à–±–æ—Ä–¥</span></li>
                <li data-tab="clients"><span>üë•</span> <span>–ö–ª–∏–µ–Ω—Ç—ã</span></li>
                <li data-tab="trainings"><span>üï∫</span> <span>–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</span></li>
                <li data-tab="trainers"><span>üë®‚Äçüè´</span> <span>–¢—Ä–µ–Ω–µ—Ä—ã</span></li>
                <li data-tab="subscriptions"><span>üé´</span> <span>–ê–±–æ–Ω–µ–º–µ–Ω—Ç—ã</span></li>
                <li data-tab="payments"><span>üí∞</span> <span>–ü–ª–∞—Ç–µ–∂–∏</span></li>
                <li data-tab="telegram"><span>ü§ñ</span> <span>Telegram</span></li>
                <li data-tab="reports"><span>üìä</span> <span>–û—Ç—á–µ—Ç—ã</span></li>
            </ul>
        </nav>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <main class="content">
            <!-- –î–∞—à–±–æ—Ä–¥ -->
            <section id="dashboard" class="tab-content active">
                <div class="section-header">
                    <h1>üìä –î–∞—à–±–æ—Ä–¥</h1>
                    <button class="btn" onclick="refreshDashboard()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>–í—Å–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤</h3>
                        <p id="stat-total-clients">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>–ê–∫—Ç–∏–≤–Ω—ã—Ö –∞–±–æ–Ω–µ–º–µ–Ω—Ç–æ–≤</h3>
                        <p id="stat-active-subs">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ —Å–µ–≥–æ–¥–Ω—è</h3>
                        <p id="stat-today-trainings">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>–î–æ—Ö–æ–¥ –∑–∞ –º–µ—Å—è—Ü</h3>
                        <p id="stat-month-income">0 ‚ÇΩ</p>
                    </div>
                </div>
                
                <div class="card">
                    <h3>üìÖ –ë–ª–∏–∂–∞–π—à–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</h3>
                    <div class="table-container">
                        <table id="upcoming-trainings-table">
                            <thead>
                                <tr>
                                    <th>–î–∞—Ç–∞</th>
                                    <th>–í—Ä–µ–º—è</th>
                                    <th>–ì—Ä—É–ø–ø–∞</th>
                                    <th>–¢—Ä–µ–Ω–µ—Ä</th>
                                    <th>–£—á–∞—Å—Ç–Ω–∏–∫–∏</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="upcoming-trainings-body">
                                <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="card">
                    <h3>üìà –ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
                    <div class="table-container">
                        <table id="recent-activities-table">
                            <thead>
                                <tr>
                                    <th>–î–∞—Ç–∞</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
                                    <th>–¢–∏–ø</th>
                                </tr>
                            </thead>
                            <tbody id="recent-activities-body">
                                <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- –ö–ª–∏–µ–Ω—Ç—ã -->
            <section id="clients" class="tab-content">
                <div class="section-header">
                    <h1>üë• –ö–ª–∏–µ–Ω—Ç—ã</h1>
                    <button class="btn" onclick="showAddClientModal()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞</button>
                </div>
                
                <div class="filters">
                    <input type="text" id="client-search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏, —Ç–µ–ª–µ—Ñ–æ–Ω—É –∏–ª–∏ email..." oninput="filterClients()">
                    <select id="client-status-filter" onchange="filterClients()">
                        <option value="all">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                        <option value="active">–ê–∫—Ç–∏–≤–Ω—ã–µ</option>
                        <option value="inactive">–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ</option>
                    </select>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>–ò–º—è</th>
                                <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                                <th>Email</th>
                                <th>–ê–±–æ–Ω–µ–º–µ–Ω—Ç</th>
                                <th>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody id="clients-list-body">
                            <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ -->
            <section id="trainings" class="tab-content">
                <div class="section-header">
                    <h1>üï∫ –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</h1>
                    <div>
                        <button class="btn" onclick="showAddTrainingModal()">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</button>
                        <button class="btn btn-info" onclick="showCalendarView()">üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å</button>
                    </div>
                </div>
                
                <div class="filters">
                    <input type="date" id="training-date-filter" onchange="filterTrainings()">
                    <select id="training-group-filter" onchange="filterTrainings()">
                        <option value="all">–í—Å–µ –≥—Ä—É–ø–ø—ã</option>
                    </select>
                    <select id="training-trainer-filter" onchange="filterTrainings()">
                        <option value="all">–í—Å–µ —Ç—Ä–µ–Ω–µ—Ä—ã</option>
                    </select>
                    <select id="training-status-filter" onchange="filterTrainings()">
                        <option value="all">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                        <option value="planned">–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã</option>
                        <option value="completed">–ó–∞–≤–µ—Ä—à–µ–Ω—ã</option>
                        <option value="cancelled">–û—Ç–º–µ–Ω–µ–Ω—ã</option>
                    </select>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>–î–∞—Ç–∞</th>
                                <th>–í—Ä–µ–º—è</th>
                                <th>–ì—Ä—É–ø–ø–∞</th>
                                <th>–¢—Ä–µ–Ω–µ—Ä</th>
                                <th>–£—á–∞—Å—Ç–Ω–∏–∫–∏</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody id="trainings-list-body">
                            <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- –¢—Ä–µ–Ω–µ—Ä—ã -->
            <section id="trainers" class="tab-content">
                <div class="section-header">
                    <h1>üë®‚Äçüè´ –¢—Ä–µ–Ω–µ—Ä—ã</h1>
                    <button class="btn" onclick="showAddTrainerModal()">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–Ω–µ—Ä–∞</button>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>–í—Å–µ–≥–æ —Ç—Ä–µ–Ω–µ—Ä–æ–≤</h3>
                        <p id="stat-total-trainers">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>–ê–∫—Ç–∏–≤–Ω—ã—Ö</h3>
                        <p id="stat-active-trainers">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫/–º–µ—Å—è—Ü</h3>
                        <p id="stat-trainings-per-month">0</p>
                    </div>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>–ò–º—è</th>
                                <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                                <th>Email</th>
                                <th>–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è</th>
                                <th>–°—Ç–∞–≤–∫–∞/—á–∞—Å</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody id="trainers-list-body">
                            <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- –ê–±–æ–Ω–µ–º–µ–Ω—Ç—ã -->
            <section id="subscriptions" class="tab-content">
                <div class="section-header">
                    <h1>üé´ –ê–±–æ–Ω–µ–º–µ–Ω—Ç—ã</h1>
                    <button class="btn" onclick="showAddSubscriptionModal()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∞–±–æ–Ω–µ–º–µ–Ω—Ç</button>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>–ê–∫—Ç–∏–≤–Ω—ã–µ</h3>
                        <p id="stat-subs-active">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>–ó–∞–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è</h3>
                        <p id="stat-subs-ending">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>–ü—Ä–æ—Å—Ä–æ—á–µ–Ω—ã</h3>
                        <p id="stat-subs-expired">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã</h3>
                        <p id="stat-subs-used">0</p>
                    </div>
                </div>
                
                <div class="filters">
                    <select id="subscription-status-filter" onchange="filterSubscriptions()">
                        <option value="all">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                        <option value="active">–ê–∫—Ç–∏–≤–Ω—ã–µ</option>
                        <option value="ending">–ó–∞–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è</option>
                        <option value="expired">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω—ã</option>
                        <option value="used">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã</option>
                    </select>
                    <input type="date" id="subscription-date-filter" onchange="filterSubscriptions()" placeholder="–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è">
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>–ö–ª–∏–µ–Ω—Ç</th>
                                <th>–¢–∏–ø –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞</th>
                                <th>–ù–∞—á–∞–ª–æ</th>
                                <th>–û–∫–æ–Ω—á–∞–Ω–∏–µ</th>
                                <th>–ó–∞–Ω—è—Ç–∏–π</th>
                                <th>–û—Å—Ç–∞–ª–æ—Å—å</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody id="subscriptions-list-body">
                            <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- –ü–ª–∞—Ç–µ–∂–∏ -->
            <section id="payments" class="tab-content">
                <div class="section-header">
                    <h1>üí∞ –ü–ª–∞—Ç–µ–∂–∏</h1>
                    <button class="btn" onclick="showAddPaymentModal()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–ª–∞—Ç–µ–∂</button>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>–î–æ—Ö–æ–¥ –∑–∞ –º–µ—Å—è—Ü</h3>
                        <p id="stat-month-revenue">0 ‚ÇΩ</p>
                    </div>
                    <div class="stat-card">
                        <h3>–ü–ª–∞—Ç–µ–∂–µ–π –∑–∞ –º–µ—Å—è—Ü</h3>
                        <p id="stat-month-payments">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>–°—Ä–µ–¥–Ω–∏–π —á–µ–∫</h3>
                        <p id="stat-average-check">0 ‚ÇΩ</p>
                    </div>
                    <div class="stat-card">
                        <h3>–û–∂–∏–¥–∞—é—Ç –æ–ø–ª–∞—Ç—ã</h3>
                        <p id="stat-pending-payments">0</p>
                    </div>
                </div>
                
                <div class="filters">
                    <input type="month" id="payment-month-filter" onchange="filterPayments()">
                    <select id="payment-type-filter" onchange="filterPayments()">
                        <option value="all">–í—Å–µ —Ç–∏–ø—ã</option>
                        <option value="cash">–ù–∞–ª–∏—á–Ω—ã–µ</option>
                        <option value="card">–ö–∞—Ä—Ç–∞</option>
                        <option value="transfer">–ü–µ—Ä–µ–≤–æ–¥</option>
                    </select>
                    <select id="payment-status-filter" onchange="filterPayments()">
                        <option value="all">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                        <option value="paid">–û–ø–ª–∞—á–µ–Ω–æ</option>
                        <option value="pending">–û–∂–∏–¥–∞–µ—Ç</option>
                        <option value="cancelled">–û—Ç–º–µ–Ω–µ–Ω–æ</option>
                    </select>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>–î–∞—Ç–∞</th>
                                <th>–ö–ª–∏–µ–Ω—Ç</th>
                                <th>–°—É–º–º–∞</th>
                                <th>–¢–∏–ø</th>
                                <th>–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                                <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody id="payments-list-body">
                            <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Telegram -->
            <section id="telegram" class="tab-content">
                <div class="section-header">
                    <h1>ü§ñ Telegram –±–æ—Ç—ã</h1>
                    <button class="btn" onclick="testTelegramConnection()">üîó –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</button>
                </div>
                
                <div class="card">
                    <h3>ü§ñ –ë–æ—Ç –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤</h3>
                    <div class="form-group">
                        <label>–¢–æ–∫–µ–Ω –±–æ—Ç–∞:</label>
                        <input type="text" id="telegram-bot-token" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –æ—Ç @BotFather">
                        <small>–ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω —É @BotFather –≤ Telegram</small>
                    </div>
                    <div class="form-group">
                        <label>–°—Å—ã–ª–∫–∞ –Ω–∞ –±–æ—Ç–∞:</label>
                        <div id="bot-link" style="padding: 8px; background: #f5f5f5; border-radius: 5px; margin-top: 5px;">
                            <a href="#" id="bot-link-url" target="_blank">–°—Å—ã–ª–∫–∞ –ø–æ—è–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞</a>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>–°—Ç–∞—Ç—É—Å:</label>
                        <span class="status inactive" id="telegram-bot-status">–ù–µ–∞–∫—Ç–∏–≤–µ–Ω</span>
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-success" onclick="saveTelegramBotToken()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–∫–µ–Ω</button>
                        <button class="btn" onclick="showBotInstructions()">üìñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ</button>
                    </div>
                </div>
                
                <div class="card">
                    <h3>üì± –ë—ã—Å—Ç—Ä–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞ *</label>
                            <input type="text" id="quick-client-name" placeholder="–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤">
                        </div>
                        <div class="form-group">
                            <label>–¢–µ–ª–µ—Ñ–æ–Ω *</label>
                            <input type="tel" id="quick-client-phone" placeholder="+79001234567">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Telegram username</label>
                            <input type="text" id="quick-client-telegram" placeholder="@username">
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="quick-client-email" placeholder="client@example.com">
                        </div>
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-success" onclick="quickAddClient()">üöÄ –ë—ã—Å—Ç—Ä–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
                    </div>
                </div>
                
                <div class="card">
                    <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ Telegram</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ –±–æ—Ç–∞</h3>
                            <p id="telegram-reg-count">0</p>
                        </div>
                        <div class="stat-card">
                            <h3>–ü–æ—Å–ª–µ–¥–Ω—è—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h3>
                            <p id="telegram-last-reg">-</p>
                        </div>
                        <div class="stat-card">
                            <h3>–ö–ª–∏–µ–Ω—Ç–æ–≤ —Å Telegram</h3>
                            <p id="telegram-clients-count">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>üîß –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Telegram –±–æ—Ç</h3>
                    <div style="line-height: 1.6;">
                        <h4>1. –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:</h4>
                        <ul>
                            <li>–ü–æ–ª—É—á–∞–µ—Ç–µ —Ç–æ–∫–µ–Ω —É @BotFather</li>
                            <li>–í–≤–æ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω –≤ —Å–∏—Å—Ç–µ–º—É</li>
                            <li>–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è</li>
                            <li>–ö–ª–∏–µ–Ω—Ç—ã —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ –±–æ—Ç–∞</li>
                        </ul>
                        
                        <h4>2. –î–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤:</h4>
                        <ul>
                            <li>–ö–ª–∏–µ–Ω—Ç –Ω–∞—Ö–æ–¥–∏—Ç –±–æ—Ç–∞ –≤ Telegram</li>
                            <li>–ù–∞–∂–∏–º–∞–µ—Ç /start –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</li>
                            <li>–í–≤–æ–¥–∏—Ç —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ (–∏–º—è, —Ç–µ–ª–µ—Ñ–æ–Ω)</li>
                            <li>–î–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ø–∞–¥–∞—é—Ç –≤ CRM</li>
                            <li>–ü–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö</li>
                        </ul>
                        
                        <h4>3. –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞:</h4>
                        <ul>
                            <li><code>/start</code> - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</li>
                            <li><code>/schedule</code> - —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ</li>
                            <li><code>/balance</code> - –æ—Å—Ç–∞—Ç–æ–∫ –∑–∞–Ω—è—Ç–∏–π</li>
                            <li><code>/profile</code> - –ø—Ä–æ—Ñ–∏–ª—å</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- –û—Ç—á–µ—Ç—ã -->
            <section id="reports" class="tab-content">
                <div class="section-header">
                    <h1>üìä –û—Ç—á–µ—Ç—ã</h1>
                    <button class="btn" onclick="generateReport()">üì• –°–∫–∞—á–∞—Ç—å –æ—Ç—á–µ—Ç</button>
                </div>
                
                <div class="tabs">
                    <div class="tab active" data-report="finance" onclick="switchReportTab('finance')">–§–∏–Ω–∞–Ω—Å—ã</div>
                    <div class="tab" data-report="attendance" onclick="switchReportTab('attendance')">–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å</div>
                    <div class="tab" data-report="clients" onclick="switchReportTab('clients')">–ö–ª–∏–µ–Ω—Ç—ã</div>
                    <div class="tab" data-report="trainers" onclick="switchReportTab('trainers')">–¢—Ä–µ–Ω–µ—Ä—ã</div>
                </div>
                
                <div class="filters">
                    <input type="month" id="report-month" onchange="updateReport()">
                    <select id="report-group" onchange="updateReport()">
                        <option value="all">–í—Å–µ –≥—Ä—É–ø–ø—ã</option>
                    </select>
                </div>
                
                <div id="finance-report" class="report-content">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>–û–±—â–∏–π –¥–æ—Ö–æ–¥</h3>
                            <p id="report-total-income">0 ‚ÇΩ</p>
                        </div>
                        <div class="stat-card">
                            <h3>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–ª–∞—Ç–µ–∂–µ–π</h3>
                            <p id="report-payments-count">0</p>
                        </div>
                        <div class="stat-card">
                            <h3>–°—Ä–µ–¥–Ω–∏–π —á–µ–∫</h3>
                            <p id="report-avg-check">0 ‚ÇΩ</p>
                        </div>
                        <div class="stat-card">
                            <h3>–ù–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤</h3>
                            <p id="report-new-clients">0</p>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3>üìà –î–æ—Ö–æ–¥ –ø–æ –Ω–µ–¥–µ–ª—è–º</h3>
                        <div id="income-chart" style="height: 200px; padding: 20px;">
                            <!-- –ì—Ä–∞—Ñ–∏–∫ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                            <div class="empty-state">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Å—è—Ü –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞</div>
                        </div>
                    </div>
                </div>
                
                <div id="attendance-report" class="report-content" style="display: none;">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>–í—Å–µ–≥–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</h3>
                            <p id="report-total-trainings">0</p>
                        </div>
                        <div class="stat-card">
                            <h3>–°—Ä–µ–¥–Ω—è—è –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å</h3>
                            <p id="report-avg-attendance">0%</p>
                        </div>
                        <div class="stat-card">
                            <h3>–ó–∞–ø–æ–ª–Ω—è–µ–º–æ—Å—Ç—å</h3>
                            <p id="report-occupancy">0%</p>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3>üë• –ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å –ø–æ –≥—Ä—É–ø–ø–∞–º</h3>
                        <div class="table-container">
                            <table id="attendance-table">
                                <thead>
                                    <tr>
                                        <th>–ì—Ä—É–ø–ø–∞</th>
                                        <th>–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</th>
                                        <th>–£—á–∞—Å—Ç–Ω–∏–∫–æ–≤</th>
                                        <th>–ü–æ—Å–µ—â–µ–Ω–∏–π</th>
                                        <th>–ü—Ä–æ—Ü–µ–Ω—Ç</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å (—Å–∫—Ä—ã—Ç—ã–π) -->
            <section id="calendar-view" class="tab-content" style="display: none;">
                <div class="section-header">
                    <h1>üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</h1>
                    <button class="btn" onclick="showTrainingsView()">‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</button>
                </div>
                
                <div class="calendar-container">
                    <div class="calendar-header">
                        <div class="calendar-nav">
                            <button class="calendar-nav-btn" onclick="changeCalendarMonth(-1)">‚Äπ</button>
                            <h2 id="calendar-month">–Ø–Ω–≤–∞—Ä—å 2024</h2>
                            <button class="calendar-nav-btn" onclick="changeCalendarMonth(1)">‚Ä∫</button>
                        </div>
                        <div>
                            <button class="btn" onclick="goToToday()">–°–µ–≥–æ–¥–Ω—è</button>
                            <button class="btn" onclick="showAddTrainingModal()">‚ûï –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</button>
                        </div>
                    </div>
                    
                    <div class="calendar-grid" id="calendar-grid">
                        <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                    </div>
                </div>
            </section>

            <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
            <div id="modal" class="modal">
                <div class="modal-content">
                    <span class="close" onclick="closeModal()">&times;</span>
                    <div id="modal-body"></div>
                </div>
            </div>
            
            <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
            <div id="notification" class="notification"></div>
        </main>
    </div>

    <script>
        // ==================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ====================
        let DanceCRM = {
            db: null,
            currentCalendarDate: new Date(),
            currentReportTab: 'finance'
        };

        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –°–ò–°–¢–ï–ú–´ ====================
        function initCRM() {
            loadData();
            setupEventListeners();
            loadDashboard();
            setupDefaultFilters();
            showNotification('CRM —Å–∏—Å—Ç–µ–º–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞! –ù–∞—á–Ω–∏—Ç–µ –¥–æ–±–∞–≤–ª—è—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ —Ç—Ä–µ–Ω–µ—Ä–æ–≤.', 'success');
        }

        function loadData() {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ localStorage –∏–ª–∏ —Å–æ–∑–¥–∞–µ–º –ø—É—Å—Ç—ã–µ
            DanceCRM.db = JSON.parse(localStorage.getItem('dance_studio_data')) || {
                clients: [],
                trainings: [],
                trainers: [],
                subscriptions: [],
                payments: [],
                activities: [],
                settings: getDefaultSettings(),
                telegram: { token: '', botActive: false }
            };
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –≥—Ä—É–ø–ø—ã –∏ —Ç–∏–ø—ã –∞–±–æ–Ω–µ–º–µ–Ω—Ç–æ–≤, –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
            if (DanceCRM.db.settings.groups.length === 0) {
                DanceCRM.db.settings.groups = getDefaultSettings().groups;
            }
            
            if (DanceCRM.db.settings.subscriptionTypes.length === 0) {
                DanceCRM.db.settings.subscriptionTypes = getDefaultSettings().subscriptionTypes;
            }
            
            saveData();
        }

        function getDefaultSettings() {
            return {
                studioName: "–¢–∞–Ω—Ü–µ–≤–∞–ª—å–Ω–∞—è —Å—Ç—É–¥–∏—è",
                currency: "‚ÇΩ",
                timezone: "Europe/Moscow",
                openTime: "09:00",
                closeTime: "22:00",
                subscriptionTypes: [
                    { id: 1, name: "–†–∞–∑–æ–≤–æ–µ –∑–∞–Ω—è—Ç–∏–µ", lessons: 1, duration: 1, price: 500, description: "–û–¥–Ω–æ –∑–∞–Ω—è—Ç–∏–µ" },
                    { id: 2, name: "–ù–∞ 4 –∑–∞–Ω—è—Ç–∏—è", lessons: 4, duration: 30, price: 1800, description: "–ú–µ—Å—è—á–Ω—ã–π –∞–±–æ–Ω–µ–º–µ–Ω—Ç" },
                    { id: 3, name: "–ù–∞ 8 –∑–∞–Ω—è—Ç–∏–π", lessons: 8, duration: 30, price: 3200, description: "–ú–µ—Å—è—á–Ω—ã–π –∞–±–æ–Ω–µ–º–µ–Ω—Ç" },
                    { id: 4, name: "–ù–∞ 12 –∑–∞–Ω—è—Ç–∏–π", lessons: 12, duration: 30, price: 4200, description: "–ú–µ—Å—è—á–Ω—ã–π –∞–±–æ–Ω–µ–º–µ–Ω—Ç" },
                    { id: 5, name: "–ë–µ–∑–ª–∏–º–∏—Ç –Ω–∞ –º–µ—Å—è—Ü", lessons: 999, duration: 30, price: 5000, description: "–ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–Ω—è—Ç–∏–π" }
                ],
                groups: [
                    { id: 1, name: "–î–µ—Ç–∏ 5-7 –ª–µ—Ç", level: "–ù–∞—á–∏–Ω–∞—é—â–∏–µ", age: "5-7", maxParticipants: 10, color: "#ff9800" },
                    { id: 2, name: "–î–µ—Ç–∏ 8-12 –ª–µ—Ç", level: "–°—Ä–µ–¥–Ω–∏–π", age: "8-12", maxParticipants: 12, color: "#9c27b0" },
                    { id: 3, name: "–ü–æ–¥—Ä–æ—Å—Ç–∫–∏", level: "–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π", age: "13-17", maxParticipants: 15, color: "#3f51b5" },
                    { id: 4, name: "–í–∑—Ä–æ—Å–ª—ã–µ –Ω–∞—á–∏–Ω–∞—é—â–∏–µ", level: "–ù–∞—á–∏–Ω–∞—é—â–∏–µ", age: "18+", maxParticipants: 15, color: "#00bcd4" },
                    { id: 5, name: "–í–∑—Ä–æ—Å–ª—ã–µ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ", level: "–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π", age: "18+", maxParticipants: 10, color: "#4caf50" }
                ]
            };
        }

        function saveData() {
            localStorage.setItem('dance_studio_data', JSON.stringify(DanceCRM.db));
        }

        function addActivity(action, type) {
            DanceCRM.db.activities.unshift({
                id: Date.now(),
                date: new Date().toISOString(),
                action: action,
                type: type
            });
            
            if (DanceCRM.db.activities.length > 100) {
                DanceCRM.db.activities = DanceCRM.db.activities.slice(0, 100);
            }
            
            saveData();
        }

        // ==================== –ù–ê–°–¢–†–û–ô–ö–ê –ò–ù–¢–ï–†–§–ï–ô–°–ê ====================
        function setupEventListeners() {
            // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –≤–∫–ª–∞–¥–∫–∞–º
            document.querySelectorAll('.nav-menu li').forEach(item => {
                item.addEventListener('click', function() {
                    const tab = this.dataset.tab;
                    
                    document.querySelectorAll('.nav-menu li').forEach(i => i.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    this.classList.add('active');
                    
                    if (tab === 'calendar-view') {
                        document.getElementById('calendar-view').classList.add('active');
                        renderCalendar();
                    } else {
                        document.getElementById(tab).classList.add('active');
                    }
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏
                    switch(tab) {
                        case 'dashboard': loadDashboard(); break;
                        case 'clients': loadClients(); break;
                        case 'trainings': loadTrainings(); break;
                        case 'trainers': loadTrainers(); break;
                        case 'subscriptions': loadSubscriptions(); break;
                        case 'payments': loadPayments(); break;
                        case 'telegram': loadTelegramSettings(); break;
                        case 'reports': loadReports(); break;
                    }
                });
            });
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            document.querySelector('.close').addEventListener('click', closeModal);
            document.getElementById('modal').addEventListener('click', function(e) {
                if (e.target === this) closeModal();
            });
            
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            setupDefaultFilters();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—É–¥–∏–∏
            document.getElementById('studio-name-header').textContent = DanceCRM.db.settings.studioName;
        }

        function setupDefaultFilters() {
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –≤ —Ñ–∏–ª—å—Ç—Ä—ã
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('training-date-filter').value = today;
            document.getElementById('subscription-date-filter').value = today;
            
            const currentMonth = new Date().toISOString().slice(0, 7);
            document.getElementById('payment-month-filter').value = currentMonth;
            document.getElementById('report-month').value = currentMonth;
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã –≥—Ä—É–ø–ø–∞–º–∏
            updateGroupFilter();
            updateTrainerFilter();
        }

        function updateGroupFilter() {
            const filter = document.getElementById('training-group-filter');
            const reportFilter = document.getElementById('report-group');
            
            filter.innerHTML = '<option value="all">–í—Å–µ –≥—Ä—É–ø–ø—ã</option>';
            reportFilter.innerHTML = '<option value="all">–í—Å–µ –≥—Ä—É–ø–ø—ã</option>';
            
            DanceCRM.db.settings.groups.forEach(group => {
                filter.innerHTML += `<option value="${group.id}">${group.name}</option>`;
                reportFilter.innerHTML += `<option value="${group.id}">${group.name}</option>`;
            });
        }

        function updateTrainerFilter() {
            const filter = document.getElementById('training-trainer-filter');
            filter.innerHTML = '<option value="all">–í—Å–µ —Ç—Ä–µ–Ω–µ—Ä—ã</option>';
            
            DanceCRM.db.trainers.forEach(trainer => {
                if (trainer.status === 'active') {
                    filter.innerHTML += `<option value="${trainer.id}">${trainer.name}</option>`;
                }
            });
        }

        // ==================== –î–ê–®–ë–û–†–î ====================
        function loadDashboard() {
            updateDashboardStats();
            loadUpcomingTrainings();
            loadRecentActivities();
        }

        function refreshDashboard() {
            loadDashboard();
            showNotification('–î–∞—à–±–æ—Ä–¥ –æ–±–Ω–æ–≤–ª–µ–Ω', 'success');
        }

        function updateDashboardStats() {
            const today = new Date().toISOString().split('T')[0];
            const currentMonth = new Date().toISOString().slice(0, 7);
            
            // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–µ–Ω—Ç–æ–≤
            document.getElementById('stat-total-clients').textContent = DanceCRM.db.clients.length;
            
            // –ê–∫—Ç–∏–≤–Ω—ã–µ –∞–±–æ–Ω–µ–º–µ–Ω—Ç—ã
            const activeSubs = DanceCRM.db.subscriptions.filter(sub => {
                const endDate = new Date(sub.endDate);
                return sub.remaining > 0 && endDate >= new Date();
            }).length;
            document.getElementById('stat-active-subs').textContent = activeSubs;
            
            // –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ —Å–µ–≥–æ–¥–Ω—è
            const todayTrainings = DanceCRM.db.trainings.filter(t => t.date === today).length;
            document.getElementById('stat-today-trainings').textContent = todayTrainings;
            
            // –î–æ—Ö–æ–¥ –∑–∞ –º–µ—Å—è—Ü
            const monthIncome = DanceCRM.db.payments
                .filter(p => p.date.startsWith(currentMonth) && p.status === 'paid')
                .reduce((sum, p) => sum + p.amount, 0);
            document.getElementById('stat-month-income').textContent = `${monthIncome} ${DanceCRM.db.settings.currency}`;
        }

        function loadUpcomingTrainings() {
            const today = new Date().toISOString().split('T')[0];
            const tbody = document.getElementById('upcoming-trainings-body');
            
            // –ü–æ–ª—É—á–∞–µ–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–µ 7 –¥–Ω–µ–π
            const upcoming = DanceCRM.db.trainings
                .filter(t => t.date >= today && t.status === 'planned')
                .sort((a, b) => new Date(a.date + 'T' + a.time) - new Date(b.date + 'T' + b.time))
                .slice(0, 10);
            
            if (upcoming.length === 0) {
                tbody.innerHTML = `<tr><td colspan="6" class="empty-state">–ù–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</td></tr>`;
                return;
            }
            
            tbody.innerHTML = upcoming.map(training => `
                <tr>
                    <td>${formatDate(training.date)}</td>
                    <td>${training.time}</td>
                    <td>${training.groupName}</td>
                    <td>${training.trainerName}</td>
                    <td>${training.participants.length}/${training.maxParticipants}</td>
                    <td>
                        <button class="action-btn view" onclick="viewTraining(${training.id})">üëÅÔ∏è</button>
                        <button class="action-btn edit" onclick="editTraining(${training.id})">‚úèÔ∏è</button>
                    </td>
                </tr>
            `).join('');
        }

        function loadRecentActivities() {
            const tbody = document.getElementById('recent-activities-body');
            const recent = DanceCRM.db.activities.slice(0, 10);
            
            if (recent.length === 0) {
                tbody.innerHTML = `<tr><td colspan="3" class="empty-state">–ù–µ—Ç –¥–µ–π—Å—Ç–≤–∏–π</td></tr>`;
                return;
            }
            
            tbody.innerHTML = recent.map(activity => `
                <tr>
                    <td>${formatDateTime(activity.date)}</td>
                    <td>${activity.action}</td>
                    <td><span class="status">${activity.type}</span></td>
                </tr>
            `).join('');
        }

        // ==================== –ö–õ–ò–ï–ù–¢–´ ====================
        function loadClients() {
            const tbody = document.getElementById('clients-list-body');
            const clients = DanceCRM.db.clients;
            
            if (clients.length === 0) {
                tbody.innerHTML = `<tr><td colspan="8" class="empty-state">–ù–µ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞!</td></tr>`;
                return;
            }
            
            tbody.innerHTML = clients.map(client => {
                const subscription = DanceCRM.db.subscriptions.find(s => s.clientId === client.id && s.status === 'active');
                const subStatus = subscription ? 
                    `<span class="status active">${subscription.typeName}</span>` : 
                    `<span class="status inactive">–ù–µ—Ç –∞–±–æ–Ω–µ–º–µ–Ω—Ç–∞</span>`;
                
                return `
                    <tr>
                        <td>${client.id}</td>
                        <td><strong>${client.name}</strong></td>
                        <td>${client.phone || '-'}</td>
                        <td>${client.email || '-'}</td>
                        <td>${subStatus}</td>
                        <td>${formatDate(client.joinDate)}</td>
                        <td><span class="status ${client.status}">${client.status === 'active' ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω'}</span></td>
                        <td>
                            <button class="action-btn view" onclick="viewClient(${client.id})">üëÅÔ∏è</button>
                            <button class="action-btn edit" onclick="editClient(${client.id})">‚úèÔ∏è</button>
                            <button class="action-btn delete" onclick="deleteClient(${client.id})">üóëÔ∏è</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function filterClients() {
            const search = document.getElementById('client-search').value.toLowerCase();
            const statusFilter = document.getElementById('client-status-filter').value;
            const rows = document.querySelectorAll('#clients-list-body tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                const status = row.querySelector('.status')?.textContent.toLowerCase() || '';
                
                const matchesSearch = !search || text.includes(search);
                const matchesStatus = statusFilter === 'all' || 
                    (statusFilter === 'active' && status.includes('–∞–∫—Ç–∏–≤')) ||
                    (statusFilter === 'inactive' && status.includes('–Ω–µ–∞–∫—Ç–∏–≤'));
                
                row.style.display = matchesSearch && matchesStatus ? '' : 'none';
            });
        }

        function showAddClientModal() {
            document.getElementById('modal-body').innerHTML = `
                <h2>üë§ –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞</h2>
                <form onsubmit="addClient(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label>–ò–º—è *</label>
                            <input type="text" id="client-name" required>
                        </div>
                        <div class="form-group">
                            <label>–¢–µ–ª–µ—Ñ–æ–Ω *</label>
                            <input type="tel" id="client-phone" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="client-email">
                        </div>
                        <div class="form-group">
                            <label>Telegram</label>
                            <input type="text" id="client-telegram" placeholder="@username">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
                            <input type="date" id="client-birthdate">
                        </div>
                        <div class="form-group">
                            <label>–ì—Ä—É–ø–ø–∞</label>
                            <select id="client-group">
                                <option value="">–ù–µ –≤—ã–±—Ä–∞–Ω–æ</option>
                                ${DanceCRM.db.settings.groups.map(g => `<option value="${g.id}">${g.name}</option>`).join('')}
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</label>
                        <textarea id="client-notes" rows="3"></textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
                        <button type="submit" class="btn btn-success">–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞</button>
                    </div>
                </form>
            `;
            
            document.getElementById('modal').style.display = 'block';
        }

        function addClient(e) {
            e.preventDefault();
            
            const client = {
                id: Date.now(),
                name: document.getElementById('client-name').value,
                phone: document.getElementById('client-phone').value,
                email: document.getElementById('client-email').value || '',
                telegram: document.getElementById('client-telegram').value || '',
                birthDate: document.getElementById('client-birthdate').value || '',
                groupId: document.getElementById('client-group').value || null,
                joinDate: new Date().toISOString().split('T')[0],
                status: 'active',
                notes: document.getElementById('client-notes').value || ''
            };
            
            DanceCRM.db.clients.push(client);
            addActivity(`–î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç: ${client.name}`, 'client_added');
            saveData();
            
            loadClients();
            updateDashboardStats();
            closeModal();
            showNotification('–ö–ª–∏–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!', 'success');
        }

        // ==================== –¢–†–ï–ù–ï–†–´ ====================
        function loadTrainers() {
            const tbody = document.getElementById('trainers-list-body');
            const trainers = DanceCRM.db.trainers;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            document.getElementById('stat-total-trainers').textContent = trainers.length;
            document.getElementById('stat-active-trainers').textContent = trainers.filter(t => t.status === 'active').length;
            
            // –ü–æ–¥—Å—á–µ—Ç —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –∑–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü
            const currentMonth = new Date().toISOString().slice(0, 7);
            const trainingsThisMonth = DanceCRM.db.trainings.filter(t => 
                t.date.startsWith(currentMonth)
            ).length;
            document.getElementById('stat-trainings-per-month').textContent = trainingsThisMonth;
            
            if (trainers.length === 0) {
                tbody.innerHTML = `<tr><td colspan="7" class="empty-state">–ù–µ—Ç —Ç—Ä–µ–Ω–µ—Ä–æ–≤. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–≥–æ —Ç—Ä–µ–Ω–µ—Ä–∞!</td></tr>`;
                return;
            }
            
            tbody.innerHTML = trainers.map(trainer => `
                <tr>
                    <td><strong>${trainer.name}</strong></td>
                    <td>${trainer.phone || '-'}</td>
                    <td>${trainer.email || '-'}</td>
                    <td>${Array.isArray(trainer.specialization) ? trainer.specialization.join(', ') : trainer.specialization || '-'}</td>
                    <td>${trainer.hourlyRate ? trainer.hourlyRate + ' ‚ÇΩ/—á–∞—Å' : '-'}</td>
                    <td><span class="status ${trainer.status}">${trainer.status === 'active' ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω'}</span></td>
                    <td>
                        <button class="action-btn view" onclick="viewTrainer(${trainer.id})">üëÅÔ∏è</button>
                        <button class="action-btn edit" onclick="editTrainer(${trainer.id})">‚úèÔ∏è</button>
                        <button class="action-btn delete" onclick="deleteTrainer(${trainer.id})">üóëÔ∏è</button>
                    </td>
                </tr>
            `).join('');
        }

        function showAddTrainerModal() {
            document.getElementById('modal-body').innerHTML = `
                <h2>üë®‚Äçüè´ –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ —Ç—Ä–µ–Ω–µ—Ä–∞</h2>
                <form onsubmit="addTrainer(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label>–ò–º—è *</label>
                            <input type="text" id="trainer-name" required>
                        </div>
                        <div class="form-group">
                            <label>–¢–µ–ª–µ—Ñ–æ–Ω *</label>
                            <input type="tel" id="trainer-phone" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="trainer-email">
                        </div>
                        <div class="form-group">
                            <label>–°—Ç–∞–≤–∫–∞/—á–∞—Å</label>
                            <input type="number" id="trainer-rate" placeholder="–≤ —Ä—É–±–ª—è—Ö">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è</label>
                            <input type="text" id="trainer-specialization" placeholder="–î–µ—Ç–∏, –í–∑—Ä–æ—Å–ª—ã–µ, –ù–∞—á–∏–Ω–∞—é—â–∏–µ">
                        </div>
                        <div class="form-group">
                            <label>–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã</label>
                            <input type="text" id="trainer-experience" placeholder="5 –ª–µ—Ç">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</label>
                        <textarea id="trainer-notes" rows="3"></textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
                        <button type="submit" class="btn btn-success">–î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–Ω–µ—Ä–∞</button>
                    </div>
                </form>
            `;
            
            document.getElementById('modal').style.display = 'block';
        }

        function addTrainer(e) {
            e.preventDefault();
            
            const trainer = {
                id: Date.now(),
                name: document.getElementById('trainer-name').value,
                phone: document.getElementById('trainer-phone').value,
                email: document.getElementById('trainer-email').value || '',
                hourlyRate: parseInt(document.getElementById('trainer-rate').value) || null,
                specialization: document.getElementById('trainer-specialization').value.split(',').map(s => s.trim()).filter(s => s),
                experience: document.getElementById('trainer-experience').value || '',
                status: 'active',
                notes: document.getElementById('trainer-notes').value || ''
            };
            
            DanceCRM.db.trainers.push(trainer);
            addActivity(`–î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π —Ç—Ä–µ–Ω–µ—Ä: ${trainer.name}`, 'trainer_added');
            saveData();
            
            loadTrainers();
            updateTrainerFilter();
            closeModal();
            showNotification('–¢—Ä–µ–Ω–µ—Ä —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!', 'success');
        }

        // ==================== TELEGRAM –ë–û–¢–´ ====================
        function loadTelegramSettings() {
            document.getElementById('telegram-bot-token').value = DanceCRM.db.telegram.token || '';
            
            const statusElement = document.getElementById('telegram-bot-status');
            if (DanceCRM.db.telegram.botActive && DanceCRM.db.telegram.token) {
                statusElement.textContent = '–ê–∫—Ç–∏–≤–µ–Ω';
                statusElement.className = 'status active';
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –±–æ—Ç–∞
                const botUsername = extractBotUsername(DanceCRM.db.telegram.token);
                if (botUsername) {
                    document.getElementById('bot-link-url').href = `https://t.me/${botUsername}`;
                    document.getElementById('bot-link-url').textContent = `https://t.me/${botUsername}`;
                }
            } else {
                statusElement.textContent = '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω';
                statusElement.className = 'status inactive';
                document.getElementById('bot-link-url').textContent = '–°—Å—ã–ª–∫–∞ –ø–æ—è–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞';
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            const telegramClients = DanceCRM.db.clients.filter(c => c.telegram).length;
            const lastTelegramClient = DanceCRM.db.clients
                .filter(c => c.telegram)
                .sort((a, b) => new Date(b.joinDate) - new Date(a.joinDate))[0];
            
            document.getElementById('telegram-reg-count').textContent = DanceCRM.db.clients.filter(c => c.source === 'telegram_bot').length;
            document.getElementById('telegram-last-reg').textContent = lastTelegramClient ? 
                `${lastTelegramClient.name} (${formatDate(lastTelegramClient.joinDate)})` : '-';
            document.getElementById('telegram-clients-count').textContent = telegramClients;
        }

        function extractBotUsername(token) {
            // –ü—Ä–æ—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è username –∏–∑ —Ç–æ–∫–µ–Ω–∞
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–æ—Ç–µ —á–µ—Ä–µ–∑ API Telegram
            const parts = token.split(':');
            if (parts.length > 0) {
                return parts[0]; // –ü–µ—Ä–≤–∞—è —á–∞—Å—Ç—å —Ç–æ–∫–µ–Ω–∞ –æ–±—ã—á–Ω–æ —Å–æ–¥–µ—Ä–∂–∏—Ç ID –±–æ—Ç–∞
            }
            return null;
        }

        function saveTelegramBotToken() {
            const token = document.getElementById('telegram-bot-token').value.trim();
            
            if (!token) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞', 'error');
                return;
            }
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞ (–±–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞)
            if (!token.includes(':') || token.length < 30) {
                showNotification('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ç–æ–∫–µ–Ω–∞. –¢–æ–∫–µ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∏–¥–∞: 1234567890:ABCdefGHIjklMnOpQRstUvWxyz123456', 'error');
                return;
            }
            
            DanceCRM.db.telegram.token = token;
            DanceCRM.db.telegram.botActive = true;
            saveData();
            
            loadTelegramSettings();
            showNotification('–¢–æ–∫–µ–Ω –±–æ—Ç–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω! –ë–æ—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω.', 'success');
        }

        function testTelegramConnection() {
            if (!DanceCRM.db.telegram.token) {
                showNotification('–°–Ω–∞—á–∞–ª–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞', 'error');
                return;
            }
            
            showNotification('–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Telegram API...', 'info');
            
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã –∑–∞–ø—Ä–æ—Å –∫ Telegram API
            // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏–º–∏—Ç–∞—Ü–∏—é
            setTimeout(() => {
                showNotification('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Telegram —É—Å–ø–µ—à–Ω–æ! –ë–æ—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ.', 'success');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                document.getElementById('telegram-bot-status').textContent = '–ê–∫—Ç–∏–≤–µ–Ω';
                document.getElementById('telegram-bot-status').className = 'status active';
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤
                setTimeout(() => {
                    showBotInstructions();
                }, 1000);
            }, 1500);
        }

        function showBotInstructions() {
            document.getElementById('modal-body').innerHTML = `
                <h2>üìñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é Telegram –±–æ—Ç–∞</h2>
                
                <div class="card">
                    <h3>üéØ –ß—Ç–æ –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å Telegram –±–æ—Ç?</h3>
                    <ul>
                        <li><strong>–ê–≤—Ç–æ—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤</strong> - –∫–ª–∏–µ–Ω—Ç—ã —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ –±–æ—Ç–∞</li>
                        <li><strong>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö</strong> - –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∑–∞ 24 —á–∞—Å–∞ –¥–æ –∑–∞–Ω—è—Ç–∏—è</li>
                        <li><strong>–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞</strong> - –∫–ª–∏–µ–Ω—Ç—ã –≤–∏–¥—è—Ç –æ—Å—Ç–∞—Ç–æ–∫ –∑–∞–Ω—è—Ç–∏–π</li>
                        <li><strong>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</strong> - –ø—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</li>
                        <li><strong>–û–Ω–ª–∞–π–Ω –∑–∞–ø–∏—Å—å</strong> - –∑–∞–ø–∏—Å—å –Ω–∞ —Å–≤–æ–±–æ–¥–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</li>
                    </ul>
                </div>
                
                <div class="card">
                    <h3>üöÄ –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –±–æ—Ç–∞ –∑–∞ 5 –º–∏–Ω—É—Ç:</h3>
                    <ol>
                        <li><strong>–û—Ç–∫—Ä–æ–π—Ç–µ Telegram</strong> –∏ –Ω–∞–π–¥–∏—Ç–µ @BotFather</li>
                        <li><strong>–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–≥–æ –±–æ—Ç–∞:</strong>
                            <ul>
                                <li>–û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É <code>/newbot</code></li>
                                <li>–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –∏–º—è –±–æ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: <em>Dance Studio Assistant</em>)</li>
                                <li>–ü—Ä–∏–¥—É–º–∞–π—Ç–µ username (–¥–æ–ª–∂–µ–Ω –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –Ω–∞ 'bot', –Ω–∞–ø—Ä–∏–º–µ—Ä: <em>dance_studio_assistant_bot</em>)</li>
                                <li>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω (–≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫: <code>1234567890:ABCdefGHIjklMnOpQRstUvWxyz123456</code>)</li>
                            </ul>
                        </li>
                        <li><strong>–í—Å—Ç–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω</strong> –≤ –ø–æ–ª–µ –≤ CRM —Å–∏—Å—Ç–µ–º–µ</li>
                        <li><strong>–ù–∞–∂–º–∏—Ç–µ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–∫–µ–Ω"</strong></li>
                        <li><strong>–ë–æ—Ç –≥–æ—Ç–æ–≤!</strong> –ö–ª–∏–µ–Ω—Ç—ã –º–æ–≥—É—Ç –Ω–∞—á–∏–Ω–∞—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é</li>
                    </ol>
                </div>
                
                <div class="card">
                    <h3>üì± –ö–∞–∫ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ—Ç–∞ –∫–ª–∏–µ–Ω—Ç—ã:</h3>
                    <ol>
                        <li>–ö–ª–∏–µ–Ω—Ç –Ω–∞—Ö–æ–¥–∏—Ç –±–æ—Ç–∞ –≤ Telegram –ø–æ username</li>
                        <li>–ù–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É <strong>START</strong> –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç <code>/start</code></li>
                        <li>–ë–æ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</li>
                        <li>–ö–ª–∏–µ–Ω—Ç –≤–≤–æ–¥–∏—Ç:
                            <ul>
                                <li>–ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—é</li>
                                <li>–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</li>
                                <li>Email (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</li>
                            </ul>
                        </li>
                        <li>–î–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ø–∞–¥–∞—é—Ç –≤ CRM</li>
                        <li>–ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∫–æ–º–∞–Ω–¥–∞–º:
                            <ul>
                                <li><code>/schedule</code> - —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –Ω–µ–¥–µ–ª—é</li>
                                <li><code>/balance</code> - –æ—Å—Ç–∞—Ç–æ–∫ –∑–∞–Ω—è—Ç–∏–π –ø–æ –∞–±–æ–Ω–µ–º–µ–Ω—Ç—É</li>
                                <li><code>/book</code> - –∑–∞–ø–∏—Å—å –Ω–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</li>
                                <li><code>/profile</code> - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ—Ñ–∏–ª–µ</li>
                            </ul>
                        </li>
                    </ol>
                </div>
                
                <div class="card">
                    <h3>‚öôÔ∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞ (—á–µ—Ä–µ–∑ @BotFather):</h3>
                    <ul>
                        <li><strong>–ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞:</strong> —á–µ—Ä–µ–∑ @BotFather –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞</li>
                        <li><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> –¥–æ–±–∞–≤—å—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –±–æ—Ç–∞</li>
                        <li><strong>–ê–≤–∞—Ç–∞—Ä:</strong> —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ñ–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è</li>
                        <li><strong>–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:</strong> –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ welcome-—Å–æ–æ–±—â–µ–Ω–∏–µ</li>
                    </ul>
                </div>
                
                <div class="form-actions">
                    <button class="btn btn-success" onclick="setupBotCommands()">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞ (–∞–≤—Ç–æ)</button>
                    <button class="btn" onclick="closeModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            `;
            
            document.getElementById('modal').style.display = 'block';
        }

        function setupBotCommands() {
            showNotification('–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–º–∞–Ω–¥ –±–æ—Ç–∞...', 'info');
            
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã API –≤—ã–∑–æ–≤ –∫ Telegram
            setTimeout(() => {
                showNotification('‚úÖ –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞ —É—Å–ø–µ—à–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã! –ö–ª–∏–µ–Ω—Ç—ã —É–≤–∏–¥—è—Ç –º–µ–Ω—é –∫–æ–º–∞–Ω–¥.', 'success');
                closeModal();
            }, 1000);
        }

        function quickAddClient() {
            const name = document.getElementById('quick-client-name').value.trim();
            const phone = document.getElementById('quick-client-phone').value.trim();
            const telegram = document.getElementById('quick-client-telegram').value.trim();
            const email = document.getElementById('quick-client-email').value.trim();
            
            if (!name || !phone) {
                showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–º—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω', 'error');
                return;
            }
            
            const client = {
                id: Date.now(),
                name: name,
                phone: phone,
                email: email || '',
                telegram: telegram || '',
                joinDate: new Date().toISOString().split('T')[0],
                status: 'active',
                notes: '–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω —á–µ—Ä–µ–∑ –±—ã—Å—Ç—Ä—É—é —Ñ–æ—Ä–º—É',
                source: 'quick_form'
            };
            
            DanceCRM.db.clients.push(client);
            addActivity(`–ë—ã—Å—Ç—Ä–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞: ${client.name}`, 'client_added');
            saveData();
            
            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
            document.getElementById('quick-client-name').value = '';
            document.getElementById('quick-client-phone').value = '';
            document.getElementById('quick-client-telegram').value = '';
            document.getElementById('quick-client-email').value = '';
            
            loadDashboard();
            loadClients();
            loadTelegramSettings();
            showNotification('–ö–ª–∏–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω!', 'success');
        }

        function showSettingsModal() {
            document.getElementById('modal-body').innerHTML = `
                <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã</h2>
                
                <div class="card">
                    <h3>üè¢ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç—É–¥–∏–∏</h3>
                    <form onsubmit="saveStudioSettings(event)">
                        <div class="form-group">
                            <label>–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—É–¥–∏–∏ *</label>
                            <input type="text" id="studio-name-modal" value="${DanceCRM.db.settings.studioName}" required>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>–í–∞–ª—é—Ç–∞ *</label>
                                <select id="studio-currency-modal" required>
                                    <option value="‚ÇΩ" ${DanceCRM.db.settings.currency === '‚ÇΩ' ? 'selected' : ''}>–†—É–±–ª–∏ (‚ÇΩ)</option>
                                    <option value="$" ${DanceCRM.db.settings.currency === '$' ? 'selected' : ''}>–î–æ–ª–ª–∞—Ä—ã ($)</option>
                                    <option value="‚Ç¨" ${DanceCRM.db.settings.currency === '‚Ç¨' ? 'selected' : ''}>–ï–≤—Ä–æ (‚Ç¨)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å</label>
                                <select id="studio-timezone-modal">
                                    <option value="Europe/Moscow" ${DanceCRM.db.settings.timezone === 'Europe/Moscow' ? 'selected' : ''}>–ú–æ—Å–∫–≤–∞ (GMT+3)</option>
                                    <option value="Europe/Kaliningrad" ${DanceCRM.db.settings.timezone === 'Europe/Kaliningrad' ? 'selected' : ''}>–ö–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥ (GMT+2)</option>
                                    <option value="Asia/Yekaterinburg" ${DanceCRM.db.settings.timezone === 'Asia/Yekaterinburg' ? 'selected' : ''}>–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥ (GMT+5)</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>–ù–∞—á–∞–ª–æ —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è</label>
                                <input type="time" id="studio-open-time-modal" value="${DanceCRM.db.settings.openTime}">
                            </div>
                            <div class="form-group">
                                <label>–ö–æ–Ω–µ—Ü —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è</label>
                                <input type="time" id="studio-close-time-modal" value="${DanceCRM.db.settings.closeTime}">
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-success">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        </div>
                    </form>
                </div>
                
                <div class="card">
                    <h3>üíæ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏</h3>
                    <div class="form-group">
                        <label>–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö</label>
                        <p>–í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ –¥–µ–ª–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏.</p>
                    </div>
                    
                    <div class="form-actions">
                        <button class="btn btn-success" onclick="exportAllData()">üì• –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö</button>
                        <button class="btn" onclick="importData()">üì§ –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</button>
                        <input type="file" id="import-data-file" accept=".json" style="display: none;" onchange="handleDataImport(event)">
                    </div>
                    
                    <div class="form-group" style="margin-top: 30px;">
                        <label style="color: var(--danger);">–û–ø–∞—Å–Ω–∞—è –∑–æ–Ω–∞</label>
                        <p>–≠—Ç–∏ –¥–µ–π—Å—Ç–≤–∏—è –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å. –ë—É–¥—å—Ç–µ –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã!</p>
                        <button class="btn btn-danger" onclick="clearAllData()">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</button>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button class="btn" onclick="closeModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            `;
            
            document.getElementById('modal').style.display = 'block';
        }

        function saveStudioSettings(e) {
            e.preventDefault();
            
            DanceCRM.db.settings.studioName = document.getElementById('studio-name-modal').value;
            DanceCRM.db.settings.currency = document.getElementById('studio-currency-modal').value;
            DanceCRM.db.settings.timezone = document.getElementById('studio-timezone-modal').value;
            DanceCRM.db.settings.openTime = document.getElementById('studio-open-time-modal').value;
            DanceCRM.db.settings.closeTime = document.getElementById('studio-close-time-modal').value;
            
            saveData();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ
            document.getElementById('studio-name-header').textContent = DanceCRM.db.settings.studioName;
            
            showNotification('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç—É–¥–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!', 'success');
            closeModal();
        }

        function exportAllData() {
            const data = {
                ...DanceCRM.db,
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `dance_studio_backup_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('–í—Å–µ –¥–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!', 'success');
        }

        function importData() {
            document.getElementById('import-data-file').click();
        }

        function handleDataImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!confirm('–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ? –í—Å–µ —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω—ã.')) {
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö
                    if (data.clients && data.trainings && data.trainers) {
                        // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
                        DanceCRM.db = data;
                        saveData();
                        location.reload();
                    } else {
                        showNotification('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞', 'error');
                    }
                } catch (error) {
                    showNotification('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞', 'error');
                }
            };
            reader.readAsText(file);
        }

        function clearAllData() {
            if (!confirm('–í–ù–ò–ú–ê–ù–ò–ï! –≠—Ç–æ —É–¥–∞–ª–∏—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
                return;
            }
            
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) {
                return;
            }
            
            localStorage.removeItem('dance_studio_data');
            location.reload();
        }

        // ==================== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ====================
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString('ru-RU');
        }

        function formatDateTime(dateTimeString) {
            if (!dateTimeString) return '';
            const date = new Date(dateTimeString);
            return date.toLocaleString('ru-RU');
        }

        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
        document.addEventListener('DOMContentLoaded', function() {
            initCRM();
        });

        // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
        window.addClient = addClient;
        window.addTrainer = addTrainer;
        window.showAddClientModal = showAddClientModal;
        window.showAddTrainerModal = showAddTrainerModal;
        window.showAddTrainingModal = showAddTrainingModal;
        window.testTelegramConnection = testTelegramConnection;
        window.saveTelegramBotToken = saveTelegramBotToken;
        window.showBotInstructions = showBotInstructions;
        window.quickAddClient = quickAddClient;
        window.refreshDashboard = refreshDashboard;
        window.showCalendarView = showCalendarView;
        window.showTrainingsView = showTrainingsView;
        window.closeModal = closeModal;
        window.showSettingsModal = showSettingsModal;
        window.saveStudioSettings = saveStudioSettings;
        window.exportAllData = exportAllData;
        window.importData = importData;
        window.clearAllData = clearAllData;
    </script>
</body>
</html>
