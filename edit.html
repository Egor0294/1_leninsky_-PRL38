
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Редактор сайта танцевальной студии</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4a6bff;
            --primary-dark: #3a56d4;
            --secondary: #8b5cf6;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            --light: #f8fafc;
            --dark: #1e293b;
            --border: #e2e8f0;
            --radius: 8px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--light); color: var(--dark); line-height: 1.6; }
        .container { max-width: 1400px; margin: 0 auto; padding: 0 20px; }
        
        /* Header */
        .header { background: white; padding: 20px 0; border-bottom: 1px solid var(--border); margin-bottom: 30px; box-shadow: var(--shadow); }
        .header-container { display: flex; justify-content: space-between; align-items: center; }
        .logo { display: flex; align-items: center; gap: 10px; font-size: 1.5rem; font-weight: 800; color: var(--primary); }
        .header-actions { display: flex; gap: 10px; }
        
        /* Tabs */
        .tabs { display: flex; gap: 5px; margin-bottom: 30px; border-bottom: 1px solid var(--border); overflow-x: auto; }
        .tab { padding: 12px 20px; background: none; border: none; cursor: pointer; font-weight: 600; color: #64748b; border-bottom: 3px solid transparent; white-space: nowrap; transition: var(--transition); }
        .tab:hover { color: var(--primary); background: rgba(74, 107, 255, 0.05); }
        .tab.active { color: var(--primary); border-bottom-color: var(--primary); background: rgba(74, 107, 255, 0.1); }
        .tab-badge { background: var(--primary); color: white; padding: 2px 6px; border-radius: 10px; font-size: 12px; margin-left: 5px; }
        
        /* Sections */
        .section { display: none; animation: fadeIn 0.3s ease; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Form */
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .form-card { background: white; border-radius: var(--radius); padding: 25px; box-shadow: var(--shadow); }
        .form-card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark); }
        label.required::after { content: " *"; color: var(--danger); }
        .form-control { width: 100%; padding: 12px 15px; border: 1px solid var(--border); border-radius: var(--radius); font-size: 1rem; transition: var(--transition); }
        .form-control:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(74, 107, 255, 0.1); }
        textarea.form-control { min-height: 100px; resize: vertical; }
        .form-help { font-size: 12px; color: #64748b; margin-top: 5px; }
        
        /* Buttons */
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 8px; padding: 12px 24px; border: none; border-radius: var(--radius); font-weight: 600; cursor: pointer; transition: var(--transition); text-decoration: none; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-dark); transform: translateY(-2px); box-shadow: var(--shadow-lg); }
        .btn-secondary { background: var(--secondary); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-warning { background: var(--warning); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-info { background: var(--info); color: white; }
        .btn-outline { background: white; color: var(--primary); border: 1px solid var(--primary); }
        .btn-sm { padding: 8px 16px; font-size: 14px; }
        .btn-xs { padding: 4px 8px; font-size: 12px; }
        .btn-group { display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap; }
        .btn-group-center { justify-content: center; }
        
        /* List items */
        .list-item { background: white; border: 1px solid var(--border); border-radius: var(--radius); padding: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; transition: var(--transition); }
        .list-item:hover { border-color: var(--primary); box-shadow: var(--shadow); }
        .list-item-content { flex: 1; }
        .list-item-actions { display: flex; gap: 5px; }
        .list-item-title { font-weight: 600; color: var(--dark); margin-bottom: 5px; }
        .list-item-subtitle { font-size: 14px; color: #64748b; }
        
        /* Alerts */
        .alert { padding: 15px; border-radius: var(--radius); margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; }
        .alert-success { background: #d1fae5; color: #065f46; border: 1px solid #a7f3d0; }
        .alert-danger { background: #fee2e2; color: #991b1b; border: 1px solid #fecaca; }
        .alert-warning { background: #fef3c7; color: #92400e; border: 1px solid #fde68a; }
        .alert-info { background: #dbeafe; color: #1e40af; border: 1px solid #bfdbfe; }
        .alert-close { background: none; border: none; color: inherit; cursor: pointer; font-size: 18px; }
        
        /* Preview */
        .preview-container { background: white; border-radius: var(--radius); padding: 25px; box-shadow: var(--shadow); }
        .preview-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; margin-top: 20px; }
        .preview-item { border: 1px solid var(--border); border-radius: var(--radius); padding: 15px; }
        .preview-item-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        
        /* Import/Export */
        .import-export-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 30px; }
        .json-editor-container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .json-editor { font-family: 'Courier New', monospace; font-size: 14px; line-height: 1.5; }
        .data-viewer { max-height: 500px; overflow-y: auto; border: 1px solid var(--border); border-radius: var(--radius); padding: 15px; background: #f8fafc; }
        
        /* Data Manager */
        .data-manager-grid { display: grid; grid-template-columns: 300px 1fr; gap: 30px; }
        .data-sidebar { background: white; border-radius: var(--radius); padding: 20px; box-shadow: var(--shadow); }
        .data-content { background: white; border-radius: var(--radius); padding: 25px; box-shadow: var(--shadow); }
        .data-list { max-height: 500px; overflow-y: auto; }
        .data-list-item { padding: 12px 15px; border-bottom: 1px solid var(--border); cursor: pointer; transition: var(--transition); }
        .data-list-item:hover { background: rgba(74, 107, 255, 0.05); }
        .data-list-item.active { background: rgba(74, 107, 255, 0.1); color: var(--primary); border-left: 3px solid var(--primary); }
        
        /* Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; padding: 20px; }
        .modal-content { background: white; border-radius: var(--radius); padding: 30px; max-width: 800px; width: 100%; max-height: 90vh; overflow-y: auto; position: relative; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .modal-close { background: none; border: none; font-size: 24px; cursor: pointer; color: #64748b; }
        
        /* Badges */
        .badge { display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600; }
        .badge-primary { background: rgba(74, 107, 255, 0.1); color: var(--primary); }
        .badge-success { background: rgba(16, 185, 129, 0.1); color: var(--success); }
        .badge-warning { background: rgba(245, 158, 11, 0.1); color: var(--warning); }
        
        /* Stats */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
        .stat-card { background: white; border-radius: var(--radius); padding: 20px; text-align: center; box-shadow: var(--shadow); }
        .stat-number { font-size: 2rem; font-weight: 800; color: var(--primary); margin-bottom: 5px; }
        .stat-label { color: #64748b; font-size: 14px; }
        
        /* Responsive */
        @media (max-width: 992px) {
            .json-editor-container { grid-template-columns: 1fr; }
            .data-manager-grid { grid-template-columns: 1fr; }
        }
        
        @media (max-width: 768px) {
            .header-container { flex-direction: column; gap: 15px; }
            .header-actions { width: 100%; justify-content: center; }
            .import-export-container { grid-template-columns: 1fr; }
            .form-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- Modal для подтверждения -->
    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="confirmModalTitle">Подтверждение действия</h3>
                <button class="modal-close" onclick="closeModal()">×</button>
            </div>
            <p id="confirmModalMessage"></p>
            <div class="btn-group">
                <button class="btn btn-danger" id="confirmModalYes">Да</button>
                <button class="btn btn-outline" onclick="closeModal()">Отмена</button>
            </div>
        </div>
    </div>
    
    <!-- Modal для JSON редактора -->
    <div class="modal" id="jsonModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Редактор JSON данных</h3>
                <button class="modal-close" onclick="closeModal()">×</button>
            </div>
            <p>Отредактируйте данные в формате JSON:</p>
            <textarea id="jsonEditor" class="form-control" style="min-height: 400px; font-family: monospace;" spellcheck="false"></textarea>
            <div class="btn-group">
                <button class="btn btn-primary" onclick="applyJsonChanges()">
                    <i class="fas fa-check"></i> Применить изменения
                </button>
                <button class="btn btn-outline" onclick="closeModal()">
                    <i class="fas fa-times"></i> Отмена
                </button>
            </div>
        </div>
    </div>
    
    <!-- Header -->
    <div class="header">
        <div class="container header-container">
            <div class="logo">
                <i class="fas fa-edit"></i>
                <span>Редактор сайта танцевальной студии</span>
            </div>
            <div class="header-actions">
                <button class="btn btn-success btn-sm" onclick="saveAllData()">
                    <i class="fas fa-save"></i> Сохранить все
                </button>
                <a href="studio.html" target="_blank" class="btn btn-primary btn-sm">
                    <i class="fas fa-external-link-alt"></i> Открыть сайт
                </a>
            </div>
        </div>
    </div>
    
    <div class="container">
        <!-- Вкладки -->
        <div class="tabs">
            <button class="tab active" onclick="showSection('dashboard')">
                <i class="fas fa-tachometer-alt"></i> Панель управления
                <span id="tabDashboardBadge" class="tab-badge" style="display: none;">0</span>
            </button>
            <button class="tab" onclick="showSection('studio')">
                <i class="fas fa-home"></i> Студия
            </button>
            <button class="tab" onclick="showSection('directions')">
                <i class="fas fa-dance"></i> Направления
                <span id="tabDirectionsBadge" class="tab-badge">0</span>
            </button>
            <button class="tab" onclick="showSection('schedule')">
                <i class="fas fa-calendar-alt"></i> Расписание
                <span id="tabScheduleBadge" class="tab-badge">0</span>
            </button>
            <button class="tab" onclick="showSection('prices')">
                <i class="fas fa-tags"></i> Цены
                <span id="tabPricesBadge" class="tab-badge">0</span>
            </button>
            <button class="tab" onclick="showSection('team')">
                <i class="fas fa-users"></i> Команда
                <span id="tabTeamBadge" class="tab-badge">0</span>
            </button>
            <button class="tab" onclick="showSection('gallery')">
                <i class="fas fa-images"></i> Галерея
                <span id="tabGalleryBadge" class="tab-badge">0</span>
            </button>
            <button class="tab" onclick="showSection('telegram')">
                <i class="fab fa-telegram"></i> Telegram
            </button>
            <button class="tab" onclick="showSection('data-manager')">
                <i class="fas fa-database"></i> Менеджер данных
                <span class="tab-badge">New</span>
            </button>
            <button class="tab" onclick="showSection('import-export')">
                <i class="fas fa-file-import"></i> Импорт/Экспорт
            </button>
        </div>
        
        <!-- Alert Container -->
        <div id="globalAlert"></div>
        
        <!-- Dashboard Section -->
        <div id="dashboard" class="section active">
            <h2><i class="fas fa-tachometer-alt"></i> Панель управления</h2>
            <p class="form-help">Обзор и быстрый доступ ко всем данным сайта</p>
            
            <div class="stats-grid" style="margin: 30px 0;">
                <div class="stat-card">
                    <div class="stat-number" id="statDirectionsCount">0</div>
                    <div class="stat-label">Направлений</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="statScheduleCount">0</div>
                    <div class="stat-label">Занятий в расписании</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="statPricesCount">0</div>
                    <div class="stat-label">Тарифных планов</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="statTeamCount">0</div>
                    <div class="stat-label">Преподавателей</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="statGalleryCount">0</div>
                    <div class="stat-label">Фото в галерее</div>
                </div>
            </div>
            
            <div class="form-grid">
                <div class="form-card">
                    <h3><i class="fas fa-bolt"></i> Быстрые действия</h3>
                    <div class="btn-group btn-group-center">
                        <button class="btn btn-primary" onclick="showSection('studio')">
                            <i class="fas fa-edit"></i> Редактировать информацию студии
                        </button>
                        <button class="btn btn-success" onclick="showSection('directions')">
                            <i class="fas fa-plus"></i> Добавить направление
                        </button>
                        <button class="btn btn-info" onclick="loadDemoData()">
                            <i class="fas fa-magic"></i> Загрузить демо-данные
                        </button>
                    </div>
                </div>
                
                <div class="form-card">
                    <h3><i class="fas fa-chart-line"></i> Статус данных</h3>
                    <div id="dataStatusList">
                        <!-- Статус будет загружен динамически -->
                    </div>
                    <div class="btn-group" style="margin-top: 20px;">
                        <button class="btn btn-outline" onclick="validateAllData()">
                            <i class="fas fa-check-circle"></i> Проверить данные
                        </button>
                        <button class="btn btn-success" onclick="saveAllData()">
                            <i class="fas fa-save"></i> Сохранить все
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="form-card" style="margin-top: 30px;">
                <h3><i class="fas fa-sync-alt"></i> Синхронизация</h3>
                <p>Все данные автоматически сохраняются в localStorage браузера.</p>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="exportData()">
                        <i class="fas fa-download"></i> Экспорт всех данных
                    </button>
                    <button class="btn btn-secondary" onclick="showSection('import-export')">
                        <i class="fas fa-upload"></i> Импорт данных
                    </button>
                    <button class="btn btn-warning" onclick="showJsonEditor()">
                        <i class="fas fa-code"></i> Редактировать JSON
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Studio Section -->
        <div id="studio" class="section">
            <h2><i class="fas fa-home"></i> Основная информация о студии</h2>
            
            <div class="form-grid">
                <div class="form-card">
                    <h3>Основные данные</h3>
                    <div class="form-group">
                        <label class="required">Название студии</label>
                        <input type="text" class="form-control" id="studioName" placeholder="Первый ритм Ленинского">
                    </div>
                    <div class="form-group">
                        <label>Заголовок на главной</label>
                        <input type="text" class="form-control" id="heroTitle" placeholder='Танцуют <span class="highlight">все</span> возрасты!'>
                        <div class="form-help">Можно использовать HTML теги</div>
                    </div>
                    <div class="form-group">
                        <label>Подзаголовок на главной</label>
                        <textarea class="form-control" id="heroSubtitle" placeholder="Профессиональная студия танцев в Иркутске для детей от 3 лет и взрослых до 65+. Пробное занятие всего за 300₽. Запишись прямо сейчас!"></textarea>
                    </div>
                </div>
                
                <div class="form-card">
                    <h3>Статистика для главной страницы</h3>
                    <div class="form-group">
                        <label>Направления (например: 15+)</label>
                        <input type="text" class="form-control" id="statDirections" placeholder="15+">
                    </div>
                    <div class="form-group">
                        <label>Ученики (например: 500+)</label>
                        <input type="text" class="form-control" id="statStudents" placeholder="500+">
                    </div>
                    <div class="form-group">
                        <label>Лет опыта (например: 12+)</label>
                        <input type="text" class="form-control" id="statExperience" placeholder="12+">
                    </div>
                    <div class="form-group">
                        <label>Возраст (например: 3-65)</label>
                        <input type="text" class="form-control" id="statAge" placeholder="3-65">
                    </div>
                </div>
                
                <div class="form-card">
                    <h3>Контакты</h3>
                    <div class="form-group">
                        <label class="required">Телефон</label>
                        <input type="text" class="form-control" id="studioPhone" placeholder="+7 (904) 123-31-75">
                    </div>
                    <div class="form-group">
                        <label class="required">Адрес</label>
                        <input type="text" class="form-control" id="studioAddress" placeholder="г. Иркутск, ул. 1-й Ленинский квартал, д. 1">
                    </div>
                    <div class="form-group">
                        <label>Часы работы</label>
                        <input type="text" class="form-control" id="studioHours" placeholder="Ежедневно с 8:00 до 22:00">
                    </div>
                    <div class="form-group">
                        <label>Цена пробного занятия</label>
                        <input type="text" class="form-control" id="trialPrice" placeholder="300₽">
                    </div>
                </div>
                
                <div class="form-card">
                    <h3>Текст в футере</h3>
                    <div class="form-group">
                        <label>Описание в футере</label>
                        <textarea class="form-control" id="footerDescription" placeholder="Профессиональная студия танцев для всех возрастов в Иркутске."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Текст копирайта</label>
                        <input type="text" class="form-control" id="copyright" placeholder="© 2024 Студия танцев 'Первый ритм Ленинского'. Все права защищены.">
                    </div>
                    <div class="form-group">
                        <label>Telegram бот для заявок</label>
                        <input type="text" class="form-control" id="telegramToken" placeholder="Токен бота (если есть)">
                        <div class="form-help">Формат: 1234567890:ABCDEFGHIJKLMNOPQRSTUVWXYZ</div>
                    </div>
                    <div class="form-group">
                        <label>Chat ID для заявок</label>
                        <input type="text" class="form-control" id="telegramChatId" placeholder="Ваш Chat ID (если есть)">
                    </div>
                </div>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-primary" onclick="saveStudioData()">
                    <i class="fas fa-save"></i> Сохранить данные студии
                </button>
                <button class="btn btn-outline" onclick="loadStudioData()">
                    <i class="fas fa-sync"></i> Загрузить текущие данные
                </button>
                <button class="btn btn-warning" onclick="editStudioJson()">
                    <i class="fas fa-code"></i> Редактировать как JSON
                </button>
            </div>
        </div>
        
        <!-- Directions Section -->
        <div id="directions" class="section">
            <h2><i class="fas fa-dance"></i> Танцевальные направления</h2>
            
            <div class="form-card">
                <div class="form-card-header">
                    <h3>Добавить новое направление</h3>
                    <button class="btn btn-sm btn-outline" onclick="showDirectionsJson()">
                        <i class="fas fa-code"></i> Редактировать все как JSON
                    </button>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>ID (англ., без пробелов)</label>
                        <input type="text" class="form-control" id="directionId" placeholder="baby-dance">
                        <div class="form-help">Уникальный идентификатор, используется в ссылках</div>
                    </div>
                    <div class="form-group">
                        <label class="required">Название</label>
                        <input type="text" class="form-control" id="directionTitle" placeholder="Танец-игра / Ритмика">
                    </div>
                    <div class="form-group">
                        <label>Возрастная группа</label>
                        <input type="text" class="form-control" id="directionAge" placeholder="3-7 лет">
                    </div>
                    <div class="form-group">
                        <label>Расписание</label>
                        <input type="text" class="form-control" id="directionSchedule" placeholder="Понедельник и среда в 17:00">
                    </div>
                    <div class="form-group">
                        <label>Цена</label>
                        <input type="text" class="form-control" id="directionPrice" placeholder="300₽ (пробное), 2500₽/мес">
                    </div>
                    <div class="form-group">
                        <label>Иконка FontAwesome</label>
                        <input type="text" class="form-control" id="directionIcon" placeholder="fas fa-music" value="fas fa-music">
                        <div class="form-help">Примеры: fas fa-music, fas fa-ballet-shoes, fas fa-water, fas fa-street-view</div>
                    </div>
                    <div class="form-group">
                        <label>Краткое описание</label>
                        <textarea class="form-control" id="directionDescription" placeholder="Развитие чувства ритма, координации и любви к движению через веселые игры и простые танцевальные комбинации."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Полное описание</label>
                        <textarea class="form-control" id="directionFullDescription" placeholder="Программа разработана специально для самых маленьких..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Преимущества (через запятую)</label>
                        <textarea class="form-control" id="directionBenefits" placeholder="Развитие координации, Улучшение чувства ритма, Раскрепощение, Социализация"></textarea>
                        <div class="form-help">Каждое преимущество с новой строки или через запятую</div>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="addDirection()">
                        <i class="fas fa-plus"></i> Добавить направление
                    </button>
                    <button class="btn btn-outline" onclick="clearDirectionForm()">
                        <i class="fas fa-times"></i> Очистить форму
                    </button>
                    <button class="btn btn-info" onclick="loadDemoDirections()">
                        <i class="fas fa-magic"></i> Загрузить демо-направления
                    </button>
                </div>
            </div>
            
            <h3 style="margin-top: 30px;">Список направлений (<span id="directionsCount">0</span>)</h3>
            <div id="directionsList"></div>
        </div>
        
        <!-- Schedule Section -->
        <div id="schedule" class="section">
            <h2><i class="fas fa-calendar-alt"></i> Расписание занятий</h2>
            
            <div class="form-card">
                <div class="form-card-header">
                    <h3>Добавить занятие в расписание</h3>
                    <button class="btn btn-sm btn-outline" onclick="showScheduleJson()">
                        <i class="fas fa-code"></i> Редактировать как JSON
                    </button>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="required">День недели</label>
                        <select class="form-control" id="scheduleDay">
                            <option value="Пн">Понедельник</option>
                            <option value="Вт">Вторник</option>
                            <option value="Ср">Среда</option>
                            <option value="Чт">Четверг</option>
                            <option value="Пт">Пятница</option>
                            <option value="Сб">Суббота</option>
                            <option value="Вс">Воскресенье</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="required">Время</label>
                        <input type="text" class="form-control" id="scheduleTime" placeholder="17:00">
                    </div>
                    <div class="form-group">
                        <label class="required">Направление</label>
                        <input type="text" class="form-control" id="scheduleDirection" placeholder="Танец-игра">
                    </div>
                    <div class="form-group">
                        <label>Возраст</label>
                        <input type="text" class="form-control" id="scheduleAge" placeholder="3-7 лет">
                    </div>
                    <div class="form-group">
                        <label>Длительность</label>
                        <input type="text" class="form-control" id="scheduleDuration" placeholder="60 мин">
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="addSchedule()">
                        <i class="fas fa-plus"></i> Добавить занятие
                    </button>
                    <button class="btn btn-outline" onclick="clearScheduleForm()">
                        <i class="fas fa-times"></i> Очистить форму
                    </button>
                    <button class="btn btn-info" onclick="loadDemoSchedule()">
                        <i class="fas fa-magic"></i> Загрузить демо-расписание
                    </button>
                </div>
            </div>
            
            <h3 style="margin-top: 30px;">Текущее расписание (<span id="scheduleCount">0</span>)</h3>
            <div id="scheduleList"></div>
        </div>
        
        <!-- Prices Section -->
        <div id="prices" class="section">
            <h2><i class="fas fa-tags"></i> Цены и абонементы</h2>
            
            <div class="form-card">
                <div class="form-card-header">
                    <h3>Добавить тариф</h3>
                    <button class="btn btn-sm btn-outline" onclick="showPricesJson()">
                        <i class="fas fa-code"></i> Редактировать как JSON
                    </button>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="required">Название тарифа</label>
                        <input type="text" class="form-control" id="priceTitle" placeholder="ДЕТСКИЙ АБОНЕМЕНТ">
                    </div>
                    <div class="form-group">
                        <label class="required">Цена</label>
                        <input type="text" class="form-control" id="priceAmount" placeholder="2 800₽">
                    </div>
                    <div class="form-group">
                        <label>Период действия</label>
                        <input type="text" class="form-control" id="pricePeriod" placeholder="8 занятий">
                    </div>
                    <div class="form-group">
                        <label>Особенности (каждая с новой строки)</label>
                        <textarea class="form-control" id="priceFeatures" placeholder="Абонемент на 30 дней&#10;Любое направление&#10;Заморозка на 7 дней"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Текст на кнопке</label>
                        <input type="text" class="form-control" id="priceButtonText" placeholder="Купить" value="Купить">
                    </div>
                    <div class="form-group">
                        <label>Telegram данные</label>
                        <input type="text" class="form-control" id="priceTelegramData" placeholder="child_abonement">
                        <div class="form-help">Идентификатор для Telegram бота (необязательно)</div>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="addPrice()">
                        <i class="fas fa-plus"></i> Добавить тариф
                    </button>
                    <button class="btn btn-outline" onclick="clearPriceForm()">
                        <i class="fas fa-times"></i> Очистить форму
                    </button>
                    <button class="btn btn-info" onclick="loadDemoPrices()">
                        <i class="fas fa-magic"></i> Загрузить демо-тарифы
                    </button>
                </div>
            </div>
            
            <h3 style="margin-top: 30px;">Список тарифов (<span id="pricesCount">0</span>)</h3>
            <div id="pricesList"></div>
        </div>
        
        <!-- Team Section -->
        <div id="team" class="section">
            <h2><i class="fas fa-users"></i> Команда преподавателей</h2>
            
            <div class="form-card">
                <div class="form-card-header">
                    <h3>Добавить преподавателя</h3>
                    <button class="btn btn-sm btn-outline" onclick="showTeamJson()">
                        <i class="fas fa-code"></i> Редактировать как JSON
                    </button>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="required">Инициалы (для аватара)</label>
                        <input type="text" class="form-control" id="teamInitials" placeholder="АП" maxlength="2">
                        <div class="form-help">2 буквы, будут отображаться в кружке</div>
                    </div>
                    <div class="form-group">
                        <label class="required">Имя и фамилия</label>
                        <input type="text" class="form-control" id="teamName" placeholder="Анна Петрова">
                    </div>
                    <div class="form-group">
                        <label class="required">Должность</label>
                        <input type="text" class="form-control" id="teamRole" placeholder="Главный хореограф">
                    </div>
                    <div class="form-group">
                        <label>Опыт работы</label>
                        <input type="text" class="form-control" id="teamExperience" placeholder="14 лет">
                    </div>
                    <div class="form-group">
                        <label>Дополнительная информация</label>
                        <textarea class="form-control" id="teamBio" placeholder="Образование, достижения, специализация..."></textarea>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="addTeamMember()">
                        <i class="fas fa-plus"></i> Добавить преподавателя
                    </button>
                    <button class="btn btn-outline" onclick="clearTeamForm()">
                        <i class="fas fa-times"></i> Очистить форму
                    </button>
                    <button class="btn btn-info" onclick="loadDemoTeam()">
                        <i class="fas fa-magic"></i> Загрузить демо-команду
                    </button>
                </div>
            </div>
            
            <h3 style="margin-top: 30px;">Список преподавателей (<span id="teamCount">0</span>)</h3>
            <div id="teamList"></div>
        </div>
        
        <!-- Gallery Section -->
        <div id="gallery" class="section">
            <h2><i class="fas fa-images"></i> Галерея изображений</h2>
            
            <div class="form-card">
                <div class="form-card-header">
                    <h3>Добавить изображение</h3>
                    <button class="btn btn-sm btn-outline" onclick="showGalleryJson()">
                        <i class="fas fa-code"></i> Редактировать как JSON
                    </button>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="required">URL изображения</label>
                        <input type="text" class="form-control" id="galleryImage" placeholder="https://images.unsplash.com/photo-1518834103328-93d45986dce1?auto=format&fit=crop&w=800&q=80">
                        <div class="form-help">Используйте прямые ссылки на изображения (Unsplash, ваш хостинг)</div>
                    </div>
                    <div class="form-group">
                        <label>Заголовок</label>
                        <input type="text" class="form-control" id="galleryTitle" placeholder="Основной зал">
                    </div>
                    <div class="form-group">
                        <label>Описание</label>
                        <input type="text" class="form-control" id="galleryDescription" placeholder="Профессиональное покрытие, зеркала">
                    </div>
                    <div class="form-group">
                        <label>Категория</label>
                        <input type="text" class="form-control" id="galleryCategory" placeholder="Зал">
                        <div class="form-help">Например: Зал, Занятия, Выступления, События</div>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="addGalleryItem()">
                        <i class="fas fa-plus"></i> Добавить в галерею
                    </button>
                    <button class="btn btn-outline" onclick="clearGalleryForm()">
                        <i class="fas fa-times"></i> Очистить форму
                    </button>
                    <button class="btn btn-info" onclick="loadDemoGallery()">
                        <i class="fas fa-magic"></i> Загрузить демо-галерею
                    </button>
                </div>
            </div>
            
            <h3 style="margin-top: 30px;">Текущая галерея (<span id="galleryCount">0</span>)</h3>
            <div id="galleryList" class="preview-grid"></div>
        </div>
        
        <!-- Telegram Section -->
        <div id="telegram" class="section">
            <h2><i class="fab fa-telegram"></i> Настройка Telegram бота</h2>
            
            <div class="form-card">
                <h3>Инструкция по настройке</h3>
                <ol style="margin-left: 20px; margin-bottom: 20px;">
                    <li>Создайте бота через <a href="https://t.me/BotFather" target="_blank">@BotFather</a></li>
                    <li>Получите токен бота (например: 1234567890:ABCDEFGHIJKLMNOPQRSTUVWXYZ)</li>
                    <li>Узнайте свой chat_id через <a href="https://t.me/getmyid_bot" target="_blank">@getmyid_bot</a></li>
                    <li>Вставьте данные в поля ниже</li>
                </ol>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label>Токен Telegram бота</label>
                        <input type="text" class="form-control" id="telegramTokenFull" placeholder="1234567890:ABCDEFGHIJKLMNOPQRSTUVWXYZ">
                        <div class="form-help">Полный токен из @BotFather</div>
                    </div>
                    <div class="form-group">
                        <label>Chat ID</label>
                        <input type="text" class="form-control" id="telegramChatIdFull" placeholder="123456789">
                        <div class="form-help">Ваш ID из @getmyid_bot</div>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="saveTelegramConfig()">
                        <i class="fas fa-save"></i> Сохранить настройки
                    </button>
                    <button class="btn btn-success" onclick="testTelegramConnection()">
                        <i class="fas fa-paper-plane"></i> Тестовая отправка
                    </button>
                    <button class="btn btn-info" onclick="showTelegramJson()">
                        <i class="fas fa-code"></i> Редактировать как JSON
                    </button>
                </div>
            </div>
            
            <div class="form-card" style="margin-top: 30px;">
                <h3>История заявок</h3>
                <div id="applicationsList">
                    <!-- Заявки будут загружены динамически -->
                </div>
                <div class="btn-group" style="margin-top: 20px;">
                    <button class="btn btn-outline" onclick="loadApplications()">
                        <i class="fas fa-sync"></i> Обновить список
                    </button>
                    <button class="btn btn-danger" onclick="clearApplications()">
                        <i class="fas fa-trash"></i> Очистить историю
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Data Manager Section -->
        <div id="data-manager" class="section">
            <h2><i class="fas fa-database"></i> Менеджер данных</h2>
            <p class="form-help">Просмотр и редактирование всех данных в структурированном виде</p>
            
            <div class="data-manager-grid">
                <div class="data-sidebar">
                    <h3>Разделы данных</h3>
                    <div class="data-list" id="dataSectionsList">
                        <div class="data-list-item active" onclick="showDataSection('studio')">
                            <i class="fas fa-home"></i> Информация студии
                            <span class="badge badge-primary" id="studioDataStatus">✓</span>
                        </div>
                        <div class="data-list-item" onclick="showDataSection('directions')">
                            <i class="fas fa-dance"></i> Направления
                            <span class="badge badge-success" id="directionsDataCount">0</span>
                        </div>
                        <div class="data-list-item" onclick="showDataSection('schedule')">
                            <i class="fas fa-calendar-alt"></i> Расписание
                            <span class="badge badge-success" id="scheduleDataCount">0</span>
                        </div>
                        <div class="data-list-item" onclick="showDataSection('prices')">
                            <i class="fas fa-tags"></i> Цены
                            <span class="badge badge-success" id="pricesDataCount">0</span>
                        </div>
                        <div class="data-list-item" onclick="showDataSection('team')">
                            <i class="fas fa-users"></i> Команда
                            <span class="badge badge-success" id="teamDataCount">0</span>
                        </div>
                        <div class="data-list-item" onclick="showDataSection('gallery')">
                            <i class="fas fa-images"></i> Галерея
                            <span class="badge badge-success" id="galleryDataCount">0</span>
                        </div>
                        <div class="data-list-item" onclick="showDataSection('telegram')">
                            <i class="fab fa-telegram"></i> Telegram настройки
                            <span class="badge badge-warning" id="telegramDataStatus">?</span>
                        </div>
                        <div class="data-list-item" onclick="showDataSection('applications')">
                            <i class="fas fa-clipboard-list"></i> Заявки
                            <span class="badge badge-info" id="applicationsDataCount">0</span>
                        </div>
                    </div>
                    
                    <div class="btn-group" style="margin-top: 20px;">
                        <button class="btn btn-primary" onclick="refreshDataManager()">
                            <i class="fas fa-sync"></i> Обновить
                        </button>
                        <button class="btn btn-success" onclick="validateAllData()">
                            <i class="fas fa-check-circle"></i> Проверить
                        </button>
                    </div>
                </div>
                
                <div class="data-content">
                    <div id="dataSectionContent">
                        <!-- Содержимое раздела будет загружено динамически -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Import/Export Section -->
        <div id="import-export" class="section">
            <h2><i class="fas fa-file-import"></i> Импорт и Экспорт данных</h2>
            
            <div class="import-export-container">
                <div class="form-card">
                    <h3><i class="fas fa-download"></i> Экспорт данных</h3>
                    <p>Скачайте все данные сайта в одном JSON файле для резервного копирования.</p>
                    
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="exportData()">
                            <i class="fas fa-file-export"></i> Экспорт всех данных
                        </button>
                        <button class="btn btn-outline" onclick="exportData('studio')">
                            <i class="fas fa-home"></i> Только информация студии
                        </button>
                        <button class="btn btn-outline" onclick="exportData('directions')">
                            <i class="fas fa-dance"></i> Только направления
                        </button>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <h4>Предпросмотр данных для экспорта:</h4>
                        <div class="data-viewer" id="exportPreview">
                            {/* Предпросмотр будет загружен динамически */}
                        </div>
                    </div>
                </div>
                
                <div class="form-card">
                    <h3><i class="fas fa-upload"></i> Импорт данных</h3>
                    <p>Загрузите данные из JSON файла для восстановления или переноса.</p>
                    
                    <div class="form-group">
                        <label>Выберите файл JSON</label>
                        <input type="file" class="form-control" id="importFile" accept=".json">
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-success" onclick="importData()">
                            <i class="fas fa-file-import"></i> Импорт данных
                        </button>
                        <button class="btn btn-info" onclick="showJsonEditor()">
                            <i class="fas fa-code"></i> Редактировать JSON напрямую
                        </button>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <h4>Демонстрационные данные:</h4>
                        <button class="btn btn-warning" onclick="loadDemoData()">
                            <i class="fas fa-magic"></i> Загрузить полные демо-данные
                        </button>
                        <button class="btn btn-outline" onclick="loadPartialDemoData()">
                            <i class="fas fa-puzzle-piece"></i> Загрузить частичные демо-данные
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="form-card" style="margin-top: 30px;">
                <h3><i class="fas fa-exchange-alt"></i> Массовое редактирование</h3>
                <p>Редактируйте данные в формате JSON для быстрого массового изменения.</p>
                
                <div class="json-editor-container">
                    <div>
                        <h4>Текущие данные:</h4>
                        <textarea id="currentJson" class="form-control json-editor" style="min-height: 300px;" spellcheck="false"></textarea>
                    </div>
                    <div>
                        <h4>Измененные данные:</h4>
                        <textarea id="modifiedJson" class="form-control json-editor" style="min-height: 300px;" spellcheck="false"></textarea>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="loadCurrentJson()">
                        <i class="fas fa-sync"></i> Загрузить текущие данные
                    </button>
                    <button class="btn btn-success" onclick="applyJsonChanges()">
                        <i class="fas fa-check"></i> Применить изменения
                    </button>
                    <button class="btn btn-danger" onclick="clearAllData()">
                        <i class="fas fa-trash"></i> Очистить все данные
                    </button>
                </div>
            </div>
            
            <div class="form-card" style="margin-top: 30px;">
                <h3><i class="fas fa-history"></i> История изменений</h3>
                <p>Восстановление из предыдущих версий (автосохранение каждые 5 минут).</p>
                <div id="backupHistory">
                    {/* История будет загружена динамически */}
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== ГЛОБАЛЬНЫЕ ПЕРЕМЕННЫЕ =====
        let currentDataSection = 'studio';
        let editingIndex = -1;
        let editingDataType = '';
        
        // ===== ИНИЦИАЛИЗАЦИЯ =====
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });
        
        function initializeApp() {
            // Загружаем все данные
            loadAllData();
            updateDashboard();
            loadDataStatus();
            
            // Настраиваем автосохранение
            setInterval(saveAllDataSilently, 300000); // Каждые 5 минут
            
            // Настраиваем обработчики событий
            setupEventListeners();
            
            showAlert('✅ Редактор загружен. Все изменения автоматически сохраняются.', 'success');
        }
        
        function setupEventListeners() {
            // Автосохранение при изменении полей
            document.querySelectorAll('.form-control').forEach(input => {
                input.addEventListener('change', function() {
                    showAlert('Изменение сохранено', 'info', 2000);
                });
            });
            
            // Импорт файла
            document.getElementById('importFile').addEventListener('change', handleFileImport);
        }
        
        // ===== НАВИГАЦИЯ ПО РАЗДЕЛАМ =====
        function showSection(sectionId) {
            // Скрываем все разделы
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Деактивируем все вкладки
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Показываем выбранный раздел
            document.getElementById(sectionId).classList.add('active');
            
            // Активируем соответствующую вкладку
            document.querySelector(`.tab[onclick="showSection('${sectionId}')"]`).classList.add('active');
            
            // Обновляем данные при необходимости
            if (sectionId === 'dashboard') {
                updateDashboard();
            } else if (sectionId === 'import-export') {
                loadCurrentJson();
                updateExportPreview();
            }
        }
        
        // ===== УПРАВЛЕНИЕ ДАННЫМИ СТУДИИ =====
        function saveStudioData() {
            const studioData = {
                name: document.getElementById('studioName').value.trim(),
                heroTitle: document.getElementById('heroTitle').value.trim(),
                heroSubtitle: document.getElementById('heroSubtitle').value.trim(),
                stats: {
                    directions: document.getElementById('statDirections').value.trim(),
                    students: document.getElementById('statStudents').value.trim(),
                    experience: document.getElementById('statExperience').value.trim(),
                    age: document.getElementById('statAge').value.trim()
                },
                phone: document.getElementById('studioPhone').value.trim(),
                address: document.getElementById('studioAddress').value.trim(),
                hours: document.getElementById('studioHours').value.trim(),
                trialPrice: document.getElementById('trialPrice').value.trim(),
                description: document.getElementById('footerDescription').value.trim(),
                copyright: document.getElementById('copyright').value.trim()
            };
            
            // Сохраняем Telegram настройки отдельно
            localStorage.setItem('telegram_bot_token', document.getElementById('telegramToken').value.trim());
            localStorage.setItem('telegram_chat_id', document.getElementById('telegramChatId').value.trim());
            
            localStorage.setItem('studio_data', JSON.stringify(studioData, null, 2));
            showAlert('✅ Данные студии успешно сохранены!', 'success');
            updateDataStatus();
        }
        
        function loadStudioData() {
            const studioData = JSON.parse(localStorage.getItem('studio_data') || '{}');
            
            // Основные данные
            document.getElementById('studioName').value = studioData.name || '';
            document.getElementById('heroTitle').value = studioData.heroTitle || '';
            document.getElementById('heroSubtitle').value = studioData.heroSubtitle || '';
            
            // Статистика
            if (studioData.stats) {
                document.getElementById('statDirections').value = studioData.stats.directions || '';
                document.getElementById('statStudents').value = studioData.stats.students || '';
                document.getElementById('statExperience').value = studioData.stats.experience || '';
                document.getElementById('statAge').value = studioData.stats.age || '';
            }
            
            // Контакты
            document.getElementById('studioPhone').value = studioData.phone || '';
            document.getElementById('studioAddress').value = studioData.address || '';
            document.getElementById('studioHours').value = studioData.hours || '';
            document.getElementById('trialPrice').value = studioData.trialPrice || '';
            
            // Футер
            document.getElementById('footerDescription').value = studioData.description || '';
            document.getElementById('copyright').value = studioData.copyright || '';
            
            // Telegram
            document.getElementById('telegramToken').value = localStorage.getItem('telegram_bot_token') || '';
            document.getElementById('telegramChatId').value = localStorage.getItem('telegram_chat_id') || '';
            
            showAlert('✅ Данные студии загружены!', 'success');
        }
        
        function editStudioJson() {
            const studioData = JSON.parse(localStorage.getItem('studio_data') || '{}');
            const telegramData = {
                telegram_bot_token: localStorage.getItem('telegram_bot_token') || '',
                telegram_chat_id: localStorage.getItem('telegram_chat_id') || ''
            };
            
            const allData = {
                studio_data: studioData,
                ...telegramData
            };
            
            document.getElementById('jsonEditor').value = JSON.stringify(allData, null, 2);
            editingDataType = 'studio';
            openModal('jsonModal');
        }
        
        // ===== УПРАВЛЕНИЕ НАПРАВЛЕНИЯМИ =====
        function addDirection() {
            const direction = {
                id: document.getElementById('directionId').value.trim() || 
                    'direction-' + Date.now(),
                title: document.getElementById('directionTitle').value.trim(),
                age: document.getElementById('directionAge').value.trim(),
                schedule: document.getElementById('directionSchedule').value.trim(),
                price: document.getElementById('directionPrice').value.trim(),
                icon: document.getElementById('directionIcon').value.trim() || 'fas fa-music',
                description: document.getElementById('directionDescription').value.trim(),
                fullDescription: document.getElementById('directionFullDescription').value.trim(),
                benefits: document.getElementById('directionBenefits').value
                    .split(/[,\n]/)
                    .map(b => b.trim())
                    .filter(b => b)
            };
            
            if (!direction.title) {
                showAlert('⚠️ Пожалуйста, заполните название направления', 'danger');
                return;
            }
            
            const directions = JSON.parse(localStorage.getItem('directions') || '[]');
            
            if (editingIndex >= 0) {
                // Редактирование существующего
                directions[editingIndex] = direction;
                showAlert('✅ Направление обновлено!', 'success');
            } else {
                // Добавление нового
                directions.push(direction);
                showAlert('✅ Направление добавлено!', 'success');
            }
            
            localStorage.setItem('directions', JSON.stringify(directions));
            clearDirectionForm();
            renderDirectionsList();
            updateDataStatus();
        }
        
        function clearDirectionForm() {
            document.getElementById('directionId').value = '';
            document.getElementById('directionTitle').value = '';
            document.getElementById('directionAge').value = '';
            document.getElementById('directionSchedule').value = '';
            document.getElementById('directionPrice').value = '';
            document.getElementById('directionIcon').value = 'fas fa-music';
            document.getElementById('directionDescription').value = '';
            document.getElementById('directionFullDescription').value = '';
            document.getElementById('directionBenefits').value = '';
            editingIndex = -1;
        }
        
        function renderDirectionsList() {
            const directions = JSON.parse(localStorage.getItem('directions') || '[]');
            const container = document.getElementById('directionsList');
            
            if (directions.length === 0) {
                container.innerHTML = '<div class="alert alert-info"><i class="fas fa-info-circle"></i> Направлений пока нет. Добавьте первое направление.</div>';
                document.getElementById('directionsCount').textContent = '0';
                document.getElementById('tabDirectionsBadge').textContent = '0';
                document.getElementById('tabDirectionsBadge').style.display = 'inline';
                return;
            }
            
            container.innerHTML = directions.map((dir, index) => `
                <div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-title">
                            <i class="${dir.icon || 'fas fa-music'}"></i> ${dir.title}
                            <span class="badge badge-primary">${dir.age || 'Все возрасты'}</span>
                        </div>
                        <div class="list-item-subtitle">
                            ${dir.description || ''}<br>
                            <small><i class="fas fa-calendar"></i> ${dir.schedule || 'Расписание не указано'}</small>
                        </div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-xs btn-outline" onclick="editDirection(${index})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-xs btn-danger" onclick="deleteItem('directions', ${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                        <button class="btn btn-xs btn-info" onclick="duplicateDirection(${index})">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('directionsCount').textContent = directions.length;
            document.getElementById('tabDirectionsBadge').textContent = directions.length;
            document.getElementById('tabDirectionsBadge').style.display = directions.length > 0 ? 'inline' : 'none';
        }
        
        function editDirection(index) {
            const directions = JSON.parse(localStorage.getItem('directions') || '[]');
            const dir = directions[index];
            
            document.getElementById('directionId').value = dir.id || '';
            document.getElementById('directionTitle').value = dir.title || '';
            document.getElementById('directionAge').value = dir.age || '';
            document.getElementById('directionSchedule').value = dir.schedule || '';
            document.getElementById('directionPrice').value = dir.price || '';
            document.getElementById('directionIcon').value = dir.icon || 'fas fa-music';
            document.getElementById('directionDescription').value = dir.description || '';
            document.getElementById('directionFullDescription').value = dir.fullDescription || '';
            document.getElementById('directionBenefits').value = Array.isArray(dir.benefits) ? dir.benefits.join(', ') : (dir.benefits || '');
            
            editingIndex = index;
            showSection('directions');
            showAlert('✏️ Редактирование направления. Измените данные и нажмите "Добавить направление" для сохранения.', 'info');
        }
        
        function duplicateDirection(index) {
            const directions = JSON.parse(localStorage.getItem('directions') || '[]');
            const dir = JSON.parse(JSON.stringify(directions[index]));
            
            dir.id = dir.id + '-copy-' + Date.now();
            dir.title = dir.title + ' (копия)';
            
            directions.push(dir);
            localStorage.setItem('directions', JSON.stringify(directions));
            renderDirectionsList();
            showAlert('✅ Направление дублировано!', 'success');
        }
        
        function showDirectionsJson() {
            const directions = JSON.parse(localStorage.getItem('directions') || '[]');
            document.getElementById('jsonEditor').value = JSON.stringify(directions, null, 2);
            editingDataType = 'directions';
            openModal('jsonModal');
        }
        
        function loadDemoDirections() {
            const demoDirections = [
                {
                    id: "baby-dance",
                    title: "Танец-игра / Ритмика",
                    age: "3-7 лет",
                    schedule: "Понедельник и среда в 17:00",
                    price: "300₽ (пробное), 2500₽/мес",
                    icon: "fas fa-music",
                    description: "Развитие чувства ритма, координации и любви к движению через веселые игры и простые танцевальные комбинации.",
                    fullDescription: "Программа разработана специально для самых маленьких. Занятия проходят в игровой форме, что помогает детям раскрепоститься, развить музыкальный слух и координацию движений.",
                    benefits: ["Развитие координации", "Улучшение чувства ритма", "Раскрепощение", "Социализация"]
                },
                {
                    id: "hiphop",
                    title: "Хип-хоп",
                    age: "13-25 лет",
                    schedule: "Вторник и четверг в 17:30",
                    price: "3200₽/мес (8 занятий)",
                    icon: "fas fa-street-view",
                    description: "Энергичные уличные танцы. Изучение различных стилей хип-хопа, развитие ритма и уверенности.",
                    fullDescription: "Хип-хоп - одно из самых популярных уличных направлений. Занятия включают изучение базовых движений, комбинаций и связок.",
                    benefits: ["Энергичность", "Развитие ритма", "Уверенность", "Стиль"]
                }
            ];
            
            localStorage.setItem('directions', JSON.stringify(demoDirections));
            renderDirectionsList();
            showAlert('✅ Демонстрационные направления загружены!', 'success');
        }
        
        // ===== УПРАВЛЕНИЕ РАСПИСАНИЕМ =====
        function addSchedule() {
            const scheduleItem = {
                day: document.getElementById('scheduleDay').value,
                time: document.getElementById('scheduleTime').value.trim(),
                direction: document.getElementById('scheduleDirection').value.trim(),
                age: document.getElementById('scheduleAge').value.trim(),
                duration: document.getElementById('scheduleDuration').value.trim()
            };
            
            if (!scheduleItem.time || !scheduleItem.direction) {
                showAlert('⚠️ Заполните время и направление', 'danger');
                return;
            }
            
            const schedule = JSON.parse(localStorage.getItem('schedule') || '[]');
            
            if (editingIndex >= 0) {
                schedule[editingIndex] = scheduleItem;
                showAlert('✅ Занятие обновлено!', 'success');
            } else {
                schedule.push(scheduleItem);
                showAlert('✅ Занятие добавлено в расписание!', 'success');
            }
            
            localStorage.setItem('schedule', JSON.stringify(schedule));
            clearScheduleForm();
            renderScheduleList();
            updateDataStatus();
        }
        
        function clearScheduleForm() {
            document.getElementById('scheduleTime').value = '';
            document.getElementById('scheduleDirection').value = '';
            document.getElementById('scheduleAge').value = '';
            document.getElementById('scheduleDuration').value = '';
            editingIndex = -1;
        }
        
        function renderScheduleList() {
            const schedule = JSON.parse(localStorage.getItem('schedule') || '[]');
            const container = document.getElementById('scheduleList');
            
            if (schedule.length === 0) {
                container.innerHTML = '<div class="alert alert-info"><i class="fas fa-info-circle"></i> Расписание пока пустое. Добавьте первое занятие.</div>';
                document.getElementById('scheduleCount').textContent = '0';
                document.getElementById('tabScheduleBadge').textContent = '0';
                document.getElementById('tabScheduleBadge').style.display = 'inline';
                return;
            }
            
            // Группируем по дням
            const days = ['Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб', 'Вс'];
            let html = '';
            
            days.forEach(day => {
                const daySchedule = schedule.filter(item => item.day === day);
                if (daySchedule.length === 0) return;
                
                html += `<div style="margin-bottom: 25px;">`;
                html += `<h4><i class="fas fa-calendar-day"></i> ${getDayName(day)}</h4>`;
                
                // Сортируем по времени
                daySchedule.sort((a, b) => a.time.localeCompare(b.time));
                
                html += daySchedule.map((item, index) => {
                    const globalIndex = schedule.findIndex(s => 
                        s.day === item.day && 
                        s.time === item.time && 
                        s.direction === item.direction
                    );
                    
                    return `
                        <div class="list-item">
                            <div class="list-item-content">
                                <div class="list-item-title">
                                    <i class="fas fa-clock"></i> ${item.time} - ${item.direction}
                                    ${item.age ? `<span class="badge badge-primary">${item.age}</span>` : ''}
                                </div>
                                <div class="list-item-subtitle">
                                    ${item.duration ? `<i class="fas fa-hourglass-half"></i> ${item.duration}` : ''}
                                </div>
                            </div>
                            <div class="list-item-actions">
                                <button class="btn btn-xs btn-outline" onclick="editSchedule(${globalIndex})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-xs btn-danger" onclick="deleteItem('schedule', ${globalIndex})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
                
                html += `</div>`;
            });
            
            container.innerHTML = html;
            document.getElementById('scheduleCount').textContent = schedule.length;
            document.getElementById('tabScheduleBadge').textContent = schedule.length;
            document.getElementById('tabScheduleBadge').style.display = schedule.length > 0 ? 'inline' : 'none';
        }
        
        function editSchedule(index) {
            const schedule = JSON.parse(localStorage.getItem('schedule') || '[]');
            const item = schedule[index];
            
            document.getElementById('scheduleDay').value = item.day || 'Пн';
            document.getElementById('scheduleTime').value = item.time || '';
            document.getElementById('scheduleDirection').value = item.direction || '';
            document.getElementById('scheduleAge').value = item.age || '';
            document.getElementById('scheduleDuration').value = item.duration || '';
            
            editingIndex = index;
            showSection('schedule');
            showAlert('✏️ Редактирование занятия. Измените данные и нажмите "Добавить занятие" для сохранения.', 'info');
        }
        
        function showScheduleJson() {
            const schedule = JSON.parse(localStorage.getItem('schedule') || '[]');
            document.getElementById('jsonEditor').value = JSON.stringify(schedule, null, 2);
            editingDataType = 'schedule';
            openModal('jsonModal');
        }
        
        function loadDemoSchedule() {
            const demoSchedule = [
                { day: "Пн", time: "17:00", direction: "Танец-игра", age: "3-7 лет", duration: "60 мин" },
                { day: "Вт", time: "17:30", direction: "Хип-хоп", age: "13-25 лет", duration: "90 мин" }
            ];
            
            localStorage.setItem('schedule', JSON.stringify(demoSchedule));
            renderScheduleList();
            showAlert('✅ Демонстрационное расписание загружено!', 'success');
        }
        
        // ===== УПРАВЛЕНИЕ ЦЕНАМИ =====
        function addPrice() {
            const price = {
                title: document.getElementById('priceTitle').value.trim(),
                price: document.getElementById('priceAmount').value.trim(),
                period: document.getElementById('pricePeriod').value.trim(),
                features: document.getElementById('priceFeatures').value
                    .split('\n')
                    .map(f => f.trim())
                    .filter(f => f),
                buttonText: document.getElementById('priceButtonText').value.trim() || 'Купить',
                telegramData: document.getElementById('priceTelegramData').value.trim()
            };
            
            if (!price.title || !price.price) {
                showAlert('⚠️ Заполните название и цену', 'danger');
                return;
            }
            
            const prices = JSON.parse(localStorage.getItem('prices') || '[]');
            
            if (editingIndex >= 0) {
                prices[editingIndex] = price;
                showAlert('✅ Тариф обновлен!', 'success');
            } else {
                prices.push(price);
                showAlert('✅ Тариф добавлен!', 'success');
            }
            
            localStorage.setItem('prices', JSON.stringify(prices));
            clearPriceForm();
            renderPricesList();
            updateDataStatus();
        }
        
        function clearPriceForm() {
            document.getElementById('priceTitle').value = '';
            document.getElementById('priceAmount').value = '';
            document.getElementById('pricePeriod').value = '';
            document.getElementById('priceFeatures').value = '';
            document.getElementById('priceButtonText').value = 'Купить';
            document.getElementById('priceTelegramData').value = '';
            editingIndex = -1;
        }
        
        function renderPricesList() {
            const prices = JSON.parse(localStorage.getItem('prices') || '[]');
            const container = document.getElementById('pricesList');
            
            if (prices.length === 0) {
                container.innerHTML = '<div class="alert alert-info"><i class="fas fa-info-circle"></i> Тарифы пока не добавлены. Добавьте первый тариф.</div>';
                document.getElementById('pricesCount').textContent = '0';
                document.getElementById('tabPricesBadge').textContent = '0';
                document.getElementById('tabPricesBadge').style.display = 'inline';
                return;
            }
            
            container.innerHTML = prices.map((price, index) => `
                <div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-title">
                            ${price.title}
                            <span style="font-size: 1.2em; color: #e67e22; font-weight: bold; margin-left: 10px;">${price.price}</span>
                        </div>
                        <div class="list-item-subtitle">
                            ${price.period || ''}<br>
                            ${(price.features || []).slice(0, 2).map(f => `<small><i class="fas fa-check"></i> ${f}</small>`).join('<br>')}
                            ${(price.features || []).length > 2 ? '<br><small>... и ещё ' + ((price.features || []).length - 2) + '</small>' : ''}
                        </div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-xs btn-outline" onclick="editPrice(${index})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-xs btn-danger" onclick="deleteItem('prices', ${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                        <button class="btn btn-xs btn-info" onclick="duplicatePrice(${index})">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('pricesCount').textContent = prices.length;
            document.getElementById('tabPricesBadge').textContent = prices.length;
            document.getElementById('tabPricesBadge').style.display = prices.length > 0 ? 'inline' : 'none';
        }
        
        function editPrice(index) {
            const prices = JSON.parse(localStorage.getItem('prices') || '[]');
            const price = prices[index];
            
            document.getElementById('priceTitle').value = price.title || '';
            document.getElementById('priceAmount').value = price.price || '';
            document.getElementById('pricePeriod').value = price.period || '';
            document.getElementById('priceFeatures').value = Array.isArray(price.features) ? price.features.join('\n') : '';
            document.getElementById('priceButtonText').value = price.buttonText || 'Купить';
            document.getElementById('priceTelegramData').value = price.telegramData || '';
            
            editingIndex = index;
            showSection('prices');
            showAlert('✏️ Редактирование тарифа. Измените данные и нажмите "Добавить тариф" для сохранения.', 'info');
        }
        
        function duplicatePrice(index) {
            const prices = JSON.parse(localStorage.getItem('prices') || '[]');
            const price = JSON.parse(JSON.stringify(prices[index]));
            
            price.title = price.title + ' (копия)';
            prices.push(price);
            localStorage.setItem('prices', JSON.stringify(prices));
            renderPricesList();
            showAlert('✅ Тариф дублирован!', 'success');
        }
        
        function showPricesJson() {
            const prices = JSON.parse(localStorage.getItem('prices') || '[]');
            document.getElementById('jsonEditor').value = JSON.stringify(prices, null, 2);
            editingDataType = 'prices';
            openModal('jsonModal');
        }
        
        function loadDemoPrices() {
            const demoPrices = [
                {
                    title: "ПРОБНОЕ ЗАНЯТИЕ",
                    price: "300₽",
                    period: "1 занятие",
                    features: ["Первое занятие", "Консультация педагога", "Подбор направления"],
                    buttonText: "Записаться",
                    telegramData: "trial"
                },
                {
                    title: "ДЕТСКИЙ АБОНЕМЕНТ",
                    price: "2 800₽",
                    period: "8 занятий",
                    features: ["Абонемент на 30 дней", "Любое направление", "Заморозка на 7 дней"],
                    buttonText: "Купить",
                    telegramData: "child_abonement"
                }
            ];
            
            localStorage.setItem('prices', JSON.stringify(demoPrices));
            renderPricesList();
            showAlert('✅ Демонстрационные тарифы загружены!', 'success');
        }
        
        // ===== УПРАВЛЕНИЕ КОМАНДОЙ =====
        function addTeamMember() {
            const member = {
                initials: document.getElementById('teamInitials').value.trim(),
                name: document.getElementById('teamName').value.trim(),
                role: document.getElementById('teamRole').value.trim(),
                experience: document.getElementById('teamExperience').value.trim(),
                bio: document.getElementById('teamBio').value.trim()
            };
            
            if (!member.initials || !member.name || !member.role) {
                showAlert('⚠️ Заполните обязательные поля', 'danger');
                return;
            }
            
            const team = JSON.parse(localStorage.getItem('team') || '[]');
            
            if (editingIndex >= 0) {
                team[editingIndex] = member;
                showAlert('✅ Преподаватель обновлен!', 'success');
            } else {
                team.push(member);
                showAlert('✅ Преподаватель добавлен!', 'success');
            }
            
            localStorage.setItem('team', JSON.stringify(team));
            clearTeamForm();
            renderTeamList();
            updateDataStatus();
        }
        
        function clearTeamForm() {
            document.getElementById('teamInitials').value = '';
            document.getElementById('teamName').value = '';
            document.getElementById('teamRole').value = '';
            document.getElementById('teamExperience').value = '';
            document.getElementById('teamBio').value = '';
            editingIndex = -1;
        }
        
        function renderTeamList() {
            const team = JSON.parse(localStorage.getItem('team') || '[]');
            const container = document.getElementById('teamList');
            
            if (team.length === 0) {
                container.innerHTML = '<div class="alert alert-info"><i class="fas fa-info-circle"></i> Преподаватели пока не добавлены. Добавьте первого преподавателя.</div>';
                document.getElementById('teamCount').textContent = '0';
                document.getElementById('tabTeamBadge').textContent = '0';
                document.getElementById('tabTeamBadge').style.display = 'inline';
                return;
            }
            
            container.innerHTML = team.map((member, index) => `
                <div class="list-item">
                    <div class="list-item-content">
                        <div style="display: flex; align-items: center; margin-bottom: 10px;">
                            <div style="width: 40px; height: 40px; background: #4a6bff; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; margin-right: 10px;">
                                ${member.initials}
                            </div>
                            <div>
                                <div class="list-item-title">${member.name}</div>
                                <div class="list-item-subtitle">${member.role}${member.experience ? ` • ${member.experience}` : ''}</div>
                            </div>
                        </div>
                        ${member.bio ? `<div class="list-item-subtitle"><small>${member.bio}</small></div>` : ''}
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-xs btn-outline" onclick="editTeamMember(${index})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-xs btn-danger" onclick="deleteItem('team', ${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('teamCount').textContent = team.length;
            document.getElementById('tabTeamBadge').textContent = team.length;
            document.getElementById('tabTeamBadge').style.display = team.length > 0 ? 'inline' : 'none';
        }
        
        function editTeamMember(index) {
            const team = JSON.parse(localStorage.getItem('team') || '[]');
            const member = team[index];
            
            document.getElementById('teamInitials').value = member.initials || '';
            document.getElementById('teamName').value = member.name || '';
            document.getElementById('teamRole').value = member.role || '';
            document.getElementById('teamExperience').value = member.experience || '';
            document.getElementById('teamBio').value = member.bio || '';
            
            editingIndex = index;
            showSection('team');
            showAlert('✏️ Редактирование преподавателя. Измените данные и нажмите "Добавить преподавателя" для сохранения.', 'info');
        }
        
        function showTeamJson() {
            const team = JSON.parse(localStorage.getItem('team') || '[]');
            document.getElementById('jsonEditor').value = JSON.stringify(team, null, 2);
            editingDataType = 'team';
            openModal('jsonModal');
        }
        
        function loadDemoTeam() {
            const demoTeam = [
                { initials: "АП", name: "Анна Петрова", role: "Главный хореограф", experience: "14 лет", bio: "Выпускница Московской академии хореографии" },
                { initials: "МК", name: "Михаил Козлов", role: "Преподаватель хип-хопа", experience: "6 лет", bio: "Участник российских хип-хоп баттлов" }
            ];
            
            localStorage.setItem('team', JSON.stringify(demoTeam));
            renderTeamList();
            showAlert('✅ Демонстрационная команда загружена!', 'success');
        }
        
        // ===== УПРАВЛЕНИЕ ГАЛЕРЕЕЙ =====
        function addGalleryItem() {
            const item = {
                image: document.getElementById('galleryImage').value.trim(),
                title: document.getElementById('galleryTitle').value.trim(),
                description: document.getElementById('galleryDescription').value.trim(),
                category: document.getElementById('galleryCategory').value.trim()
            };
            
            if (!item.image) {
                showAlert('⚠️ Укажите URL изображения', 'danger');
                return;
            }
            
            const gallery = JSON.parse(localStorage.getItem('gallery') || '[]');
            
            if (editingIndex >= 0) {
                gallery[editingIndex] = item;
                showAlert('✅ Изображение обновлено!', 'success');
            } else {
                gallery.push(item);
                showAlert('✅ Изображение добавлено в галерею!', 'success');
            }
            
            localStorage.setItem('gallery', JSON.stringify(gallery));
            clearGalleryForm();
            renderGalleryList();
            updateDataStatus();
        }
        
        function clearGalleryForm() {
            document.getElementById('galleryImage').value = '';
            document.getElementById('galleryTitle').value = '';
            document.getElementById('galleryDescription').value = '';
            document.getElementById('galleryCategory').value = '';
            editingIndex = -1;
        }
        
        function renderGalleryList() {
            const gallery = JSON.parse(localStorage.getItem('gallery') || '[]');
            const container = document.getElementById('galleryList');
            
            if (gallery.length === 0) {
                container.innerHTML = '<div class="alert alert-info"><i class="fas fa-info-circle"></i> Галерея пока пуста. Добавьте первое изображение.</div>';
                document.getElementById('galleryCount').textContent = '0';
                document.getElementById('tabGalleryBadge').textContent = '0';
                document.getElementById('tabGalleryBadge').style.display = 'inline';
                return;
            }
            
            container.innerHTML = gallery.map((item, index) => `
                <div class="preview-item">
                    <div class="preview-item-header">
                        <strong>${item.title || 'Без названия'}</strong>
                        <span class="badge badge-primary">${item.category || 'Без категории'}</span>
                    </div>
                    <img src="${item.image}" alt="${item.title}" style="width: 100%; height: 150px; object-fit: cover; border-radius: 4px; margin-bottom: 10px;" onerror="this.src='https://via.placeholder.com/300x150?text=Ошибка+загрузки'">
                    <div>
                        <small>${item.description || ''}</small>
                    </div>
                    <div style="text-align: right; margin-top: 10px;">
                        <button class="btn btn-xs btn-outline" onclick="editGalleryItem(${index})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-xs btn-danger" onclick="deleteItem('gallery', ${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('galleryCount').textContent = gallery.length;
            document.getElementById('tabGalleryBadge').textContent = gallery.length;
            document.getElementById('tabGalleryBadge').style.display = gallery.length > 0 ? 'inline' : 'none';
        }
        
        function editGalleryItem(index) {
            const gallery = JSON.parse(localStorage.getItem('gallery') || '[]');
            const item = gallery[index];
            
            document.getElementById('galleryImage').value = item.image || '';
            document.getElementById('galleryTitle').value = item.title || '';
            document.getElementById('galleryDescription').value = item.description || '';
            document.getElementById('galleryCategory').value = item.category || '';
            
            editingIndex = index;
            showSection('gallery');
            showAlert('✏️ Редактирование изображения. Измените данные и нажмите "Добавить в галерею" для сохранения.', 'info');
        }
        
        function showGalleryJson() {
            const gallery = JSON.parse(localStorage.getItem('gallery') || '[]');
            document.getElementById('jsonEditor').value = JSON.stringify(gallery, null, 2);
            editingDataType = 'gallery';
            openModal('jsonModal');
        }
        
        function loadDemoGallery() {
            const demoGallery = [
                {
                    image: "https://images.unsplash.com/photo-1518834103328-93d45986dce1?auto=format&fit=crop&w=800&q=80",
                    title: "Основной зал",
                    description: "Профессиональное покрытие, зеркала",
                    category: "Зал"
                }
            ];
            
            localStorage.setItem('gallery', JSON.stringify(demoGallery));
            renderGalleryList();
            showAlert('✅ Демонстрационная галерея загружена!', 'success');
        }
        
        // ===== TELEGRAM УПРАВЛЕНИЕ =====
        function saveTelegramConfig() {
            const token = document.getElementById('telegramTokenFull').value.trim();
            const chatId = document.getElementById('telegramChatIdFull').value.trim();
            
            if (!token || !chatId) {
                showAlert('⚠️ Заполните оба поля', 'danger');
                return;
            }
            
            localStorage.setItem('telegram_bot_token', token);
            localStorage.setItem('telegram_chat_id', chatId);
            
            showAlert('✅ Настройки Telegram сохранены!', 'success');
            updateDataStatus();
        }
        
        async function testTelegramConnection() {
            const token = localStorage.getItem('telegram_bot_token');
            const chatId = localStorage.getItem('telegram_chat_id');
            
            if (!token || !chatId) {
                showAlert('⚠️ Сначала сохраните настройки', 'danger');
                return;
            }
            
            try {
                const url = `https://api.telegram.org/bot${token}/sendMessage`;
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: chatId,
                        text: '✅ Тестовое сообщение от редактора сайта танцевальной студии\n\nСоединение работает корректно!',
                        parse_mode: 'HTML'
                    })
                });
                
                if (response.ok) {
                    showAlert('✅ Тестовое сообщение отправлено успешно!', 'success');
                } else {
                    const error = await response.json();
                    showAlert(`❌ Ошибка: ${error.description || 'Неизвестная ошибка'}`, 'danger');
                }
            } catch (error) {
                showAlert(`❌ Ошибка соединения: ${error.message}`, 'danger');
            }
        }
        
        function showTelegramJson() {
            const telegramData = {
                telegram_bot_token: localStorage.getItem('telegram_bot_token') || '',
                telegram_chat_id: localStorage.getItem('telegram_chat_id') || ''
            };
            
            document.getElementById('jsonEditor').value = JSON.stringify(telegramData, null, 2);
            editingDataType = 'telegram';
            openModal('jsonModal');
        }
        
        function loadApplications() {
            const applications = JSON.parse(localStorage.getItem('applications') || '[]');
            const container = document.getElementById('applicationsList');
            
            if (applications.length === 0) {
                container.innerHTML = '<div class="alert alert-info"><i class="fas fa-info-circle"></i> Заявок пока нет.</div>';
                return;
            }
            
            container.innerHTML = applications.map((app, index) => `
                <div class="list-item">
                    <div class="list-item-content">
                        <div class="list-item-title">
                            ${app.name} 
                            <small class="badge badge-primary">${app.date || new Date().toLocaleDateString()}</small>
                        </div>
                        <div class="list-item-subtitle">
                            📞 ${app.phone}<br>
                            ${app.direction ? `💃 ${app.direction}<br>` : ''}
                            ${app.comment ? `📝 ${app.comment}` : ''}
                        </div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-xs btn-danger" onclick="deleteApplication(${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        function deleteApplication(index) {
            const applications = JSON.parse(localStorage.getItem('applications') || '[]');
            applications.splice(index, 1);
            localStorage.setItem('applications', JSON.stringify(applications));
            loadApplications();
            showAlert('✅ Заявка удалена', 'success');
        }
        
        function clearApplications() {
            if (confirm('Очистить всю историю заявок?')) {
                localStorage.removeItem('applications');
                loadApplications();
                showAlert('✅ История заявок очищена', 'success');
            }
        }
        
        // ===== МЕНЕДЖЕР ДАННЫХ =====
        function showDataSection(section) {
            currentDataSection = section;
            
            // Обновляем активный элемент в списке
            document.querySelectorAll('.data-list-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`.data-list-item[onclick="showDataSection('${section}')"]`).classList.add('active');
            
            // Загружаем содержимое раздела
            const container = document.getElementById('dataSectionContent');
            
            switch(section) {
                case 'studio':
                    showStudioDataContent();
                    break;
                case 'directions':
                    showDirectionsDataContent();
                    break;
                case 'schedule':
                    showScheduleDataContent();
                    break;
                case 'prices':
                    showPricesDataContent();
                    break;
                case 'team':
                    showTeamDataContent();
                    break;
                case 'gallery':
                    showGalleryDataContent();
                    break;
                case 'telegram':
                    showTelegramDataContent();
                    break;
                case 'applications':
                    showApplicationsDataContent();
                    break;
            }
        }
        
        function showStudioDataContent() {
            const studioData = JSON.parse(localStorage.getItem('studio_data') || '{}');
            const container = document.getElementById('dataSectionContent');
            
            container.innerHTML = `
                <h3><i class="fas fa-home"></i> Информация студии</h3>
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-sm btn-outline" onclick="editStudioJson()">
                        <i class="fas fa-edit"></i> Редактировать как JSON
                    </button>
                    <button class="btn btn-sm btn-primary" onclick="showSection('studio')">
                        <i class="fas fa-external-link-alt"></i> Перейти к форме
                    </button>
                </div>
                <div class="data-viewer">
                    <pre>${JSON.stringify(studioData, null, 2)}</pre>
                </div>
            `;
        }
        
        function showDirectionsDataContent() {
            const directions = JSON.parse(localStorage.getItem('directions') || '[]');
            const container = document.getElementById('dataSectionContent');
            
            container.innerHTML = `
                <h3><i class="fas fa-dance"></i> Направления (${directions.length})</h3>
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-sm btn-outline" onclick="showDirectionsJson()">
                        <i class="fas fa-edit"></i> Редактировать как JSON
                    </button>
                    <button class="btn btn-sm btn-primary" onclick="showSection('directions')">
                        <i class="fas fa-external-link-alt"></i> Перейти к форме
                    </button>
                </div>
                <div class="data-viewer">
                    <pre>${JSON.stringify(directions, null, 2)}</pre>
                </div>
            `;
        }
        
        function showScheduleDataContent() {
            const schedule = JSON.parse(localStorage.getItem('schedule') || '[]');
            const container = document.getElementById('dataSectionContent');
            
            container.innerHTML = `
                <h3><i class="fas fa-calendar-alt"></i> Расписание (${schedule.length} занятий)</h3>
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-sm btn-outline" onclick="showScheduleJson()">
                        <i class="fas fa-edit"></i> Редактировать как JSON
                    </button>
                    <button class="btn btn-sm btn-primary" onclick="showSection('schedule')">
                        <i class="fas fa-external-link-alt"></i> Перейти к форме
                    </button>
                </div>
                <div class="data-viewer">
                    <pre>${JSON.stringify(schedule, null, 2)}</pre>
                </div>
            `;
        }
        
        function showPricesDataContent() {
            const prices = JSON.parse(localStorage.getItem('prices') || '[]');
            const container = document.getElementById('dataSectionContent');
            
            container.innerHTML = `
                <h3><i class="fas fa-tags"></i> Цены (${prices.length} тарифов)</h3>
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-sm btn-outline" onclick="showPricesJson()">
                        <i class="fas fa-edit"></i> Редактировать как JSON
                    </button>
                    <button class="btn btn-sm btn-primary" onclick="showSection('prices')">
                        <i class="fas fa-external-link-alt"></i> Перейти к форме
                    </button>
                </div>
                <div class="data-viewer">
                    <pre>${JSON.stringify(prices, null, 2)}</pre>
                </div>
            `;
        }
        
        function showTeamDataContent() {
            const team = JSON.parse(localStorage.getItem('team') || '[]');
            const container = document.getElementById('dataSectionContent');
            
            container.innerHTML = `
                <h3><i class="fas fa-users"></i> Команда (${team.length} преподавателей)</h3>
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-sm btn-outline" onclick="showTeamJson()">
                        <i class="fas fa-edit"></i> Редактировать как JSON
                    </button>
                    <button class="btn btn-sm btn-primary" onclick="showSection('team')">
                        <i class="fas fa-external-link-alt"></i> Перейти к форме
                    </button>
                </div>
                <div class="data-viewer">
                    <pre>${JSON.stringify(team, null, 2)}</pre>
                </div>
            `;
        }
        
        function showGalleryDataContent() {
            const gallery = JSON.parse(localStorage.getItem('gallery') || '[]');
            const container = document.getElementById('dataSectionContent');
            
            container.innerHTML = `
                <h3><i class="fas fa-images"></i> Галерея (${gallery.length} изображений)</h3>
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-sm btn-outline" onclick="showGalleryJson()">
                        <i class="fas fa-edit"></i> Редактировать как JSON
                    </button>
                    <button class="btn btn-sm btn-primary" onclick="showSection('gallery')">
                        <i class="fas fa-external-link-alt"></i> Перейти к форме
                    </button>
                </div>
                <div class="data-viewer">
                    <pre>${JSON.stringify(gallery, null, 2)}</pre>
                </div>
            `;
        }
        
        function showTelegramDataContent() {
            const telegramData = {
                telegram_bot_token: localStorage.getItem('telegram_bot_token') || '',
                telegram_chat_id: localStorage.getItem('telegram_chat_id') || ''
            };
            
            const container = document.getElementById('dataSectionContent');
            
            container.innerHTML = `
                <h3><i class="fab fa-telegram"></i> Telegram настройки</h3>
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-sm btn-outline" onclick="showTelegramJson()">
                        <i class="fas fa-edit"></i> Редактировать как JSON
                    </button>
                    <button class="btn btn-sm btn-primary" onclick="showSection('telegram')">
                        <i class="fas fa-external-link-alt"></i> Перейти к форме
                    </button>
                </div>
                <div class="data-viewer">
                    <pre>${JSON.stringify(telegramData, null, 2)}</pre>
                </div>
            `;
        }
        
        function showApplicationsDataContent() {
            const applications = JSON.parse(localStorage.getItem('applications') || '[]');
            const container = document.getElementById('dataSectionContent');
            
            container.innerHTML = `
                <h3><i class="fas fa-clipboard-list"></i> Заявки (${applications.length})</h3>
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-sm btn-primary" onclick="loadApplications()">
                        <i class="fas fa-sync"></i> Обновить
                    </button>
                    <button class="btn btn-sm btn-danger" onclick="clearApplications()">
                        <i class="fas fa-trash"></i> Очистить все
                    </button>
                </div>
                <div class="data-viewer">
                    <pre>${JSON.stringify(applications, null, 2)}</pre>
                </div>
            `;
        }
        
        function refreshDataManager() {
            updateDataStatus();
            showDataSection(currentDataSection);
        }
        
        // ===== ИМПОРТ/ЭКСПОРТ =====
        function exportData(type = 'all') {
            let exportData = {};
            
            switch(type) {
                case 'studio':
                    exportData = {
                        studio_data: JSON.parse(localStorage.getItem('studio_data') || '{}'),
                        telegram_bot_token: localStorage.getItem('telegram_bot_token') || '',
                        telegram_chat_id: localStorage.getItem('telegram_chat_id') || ''
                    };
                    break;
                case 'directions':
                    exportData = JSON.parse(localStorage.getItem('directions') || '[]');
                    break;
                case 'all':
                default:
                    exportData = {
                        studio_data: JSON.parse(localStorage.getItem('studio_data') || '{}'),
                        directions: JSON.parse(localStorage.getItem('directions') || '[]'),
                        schedule: JSON.parse(localStorage.getItem('schedule') || '[]'),
                        prices: JSON.parse(localStorage.getItem('prices') || '[]'),
                        team: JSON.parse(localStorage.getItem('team') || '[]'),
                        gallery: JSON.parse(localStorage.getItem('gallery') || '[]'),
                        telegram_bot_token: localStorage.getItem('telegram_bot_token') || '',
                        telegram_chat_id: localStorage.getItem('telegram_chat_id') || '',
                        applications: JSON.parse(localStorage.getItem('applications') || '[]'),
                        export_date: new Date().toISOString(),
                        export_version: '1.0'
                    };
                    break;
            }
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            let exportFileDefaultName = `studio-data-${type}-${new Date().toISOString().slice(0,10)}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showAlert(`✅ Данные "${type}" экспортированы в файл JSON`, 'success');
        }
        
        function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    importDataFromObject(importedData);
                } catch (error) {
                    showAlert('❌ Ошибка при чтении файла JSON', 'danger');
                }
            };
            
            reader.readAsText(file);
        }
        
        function importData() {
            document.getElementById('importFile').click();
        }
        
        function importDataFromObject(data) {
            if (!confirm('Импортировать данные? Существующие данные будут перезаписаны.')) {
                return;
            }
            
            try {
                // Импортируем данные в зависимости от структуры
                if (data.studio_data) {
                    localStorage.setItem('studio_data', JSON.stringify(data.studio_data));
                }
                
                if (Array.isArray(data.directions) || Array.isArray(data)) {
                    localStorage.setItem('directions', JSON.stringify(Array.isArray(data.directions) ? data.directions : data));
                }
                
                if (Array.isArray(data.schedule)) {
                    localStorage.setItem('schedule', JSON.stringify(data.schedule));
                }
                
                if (Array.isArray(data.prices)) {
                    localStorage.setItem('prices', JSON.stringify(data.prices));
                }
                
                if (Array.isArray(data.team)) {
                    localStorage.setItem('team', JSON.stringify(data.team));
                }
                
                if (Array.isArray(data.gallery)) {
                    localStorage.setItem('gallery', JSON.stringify(data.gallery));
                }
                
                if (data.telegram_bot_token) {
                    localStorage.setItem('telegram_bot_token', data.telegram_bot_token);
                }
                
                if (data.telegram_chat_id) {
                    localStorage.setItem('telegram_chat_id', data.telegram_chat_id);
                }
                
                if (Array.isArray(data.applications)) {
                    localStorage.setItem('applications', JSON.stringify(data.applications));
                }
                
                loadAllData();
                showAlert('✅ Данные успешно импортированы!', 'success');
                
            } catch (error) {
                showAlert('❌ Ошибка при импорте данных', 'danger');
            }
        }
        
        function loadCurrentJson() {
            const allData = {
                studio_data: JSON.parse(localStorage.getItem('studio_data') || '{}'),
                directions: JSON.parse(localStorage.getItem('directions') || '[]'),
                schedule: JSON.parse(localStorage.getItem('schedule') || '[]'),
                prices: JSON.parse(localStorage.getItem('prices') || '[]'),
                team: JSON.parse(localStorage.getItem('team') || '[]'),
                gallery: JSON.parse(localStorage.getItem('gallery') || '[]'),
                telegram_bot_token: localStorage.getItem('telegram_bot_token') || '',
                telegram_chat_id: localStorage.getItem('telegram_chat_id') || '',
                applications: JSON.parse(localStorage.getItem('applications') || '[]')
            };
            
            const jsonStr = JSON.stringify(allData, null, 2);
            document.getElementById('currentJson').value = jsonStr;
            document.getElementById('modifiedJson').value = jsonStr;
        }
        
        function applyJsonChanges() {
            try {
                const modifiedJson = document.getElementById('modifiedJson').value;
                const data = JSON.parse(modifiedJson);
                importDataFromObject(data);
            } catch (error) {
                showAlert('❌ Ошибка в формате JSON', 'danger');
            }
        }
        
        function updateExportPreview() {
            const allData = {
                studio_data: JSON.parse(localStorage.getItem('studio_data') || '{}'),
                directions: JSON.parse(localStorage.getItem('directions') || '[]'),
                schedule: JSON.parse(localStorage.getItem('schedule') || '[]'),
                prices: JSON.parse(localStorage.getItem('prices') || '[]'),
                team: JSON.parse(localStorage.getItem('team') || '[]'),
                gallery: JSON.parse(localStorage.getItem('gallery') || '[]')
            };
            
            const preview = document.getElementById('exportPreview');
            preview.innerHTML = `<pre>${JSON.stringify(allData, null, 2)}</pre>`;
        }
        
        // ===== JSON РЕДАКТОР =====
        function showJsonEditor() {
            const allData = {
                studio_data: JSON.parse(localStorage.getItem('studio_data') || '{}'),
                directions: JSON.parse(localStorage.getItem('directions') || '[]'),
                schedule: JSON.parse(localStorage.getItem('schedule') || '[]'),
                prices: JSON.parse(localStorage.getItem('prices') || '[]'),
                team: JSON.parse(localStorage.getItem('team') || '[]'),
                gallery: JSON.parse(localStorage.getItem('gallery') || '[]'),
                telegram_bot_token: localStorage.getItem('telegram_bot_token') || '',
                telegram_chat_id: localStorage.getItem('telegram_chat_id') || '',
                applications: JSON.parse(localStorage.getItem('applications') || '[]')
            };
            
            document.getElementById('jsonEditor').value = JSON.stringify(allData, null, 2);
            editingDataType = 'all';
            openModal('jsonModal');
        }
        
        function applyJsonChangesFromModal() {
            try {
                const jsonText = document.getElementById('jsonEditor').value;
                const data = JSON.parse(jsonText);
                
                if (editingDataType === 'all') {
                    importDataFromObject(data);
                } else {
                    // Импорт конкретного типа данных
                    switch(editingDataType) {
                        case 'studio':
                            if (data.studio_data) {
                                localStorage.setItem('studio_data', JSON.stringify(data.studio_data));
                            }
                            if (data.telegram_bot_token) {
                                localStorage.setItem('telegram_bot_token', data.telegram_bot_token);
                            }
                            if (data.telegram_chat_id) {
                                localStorage.setItem('telegram_chat_id', data.telegram_chat_id);
                            }
                            break;
                        case 'directions':
                            if (Array.isArray(data)) {
                                localStorage.setItem('directions', JSON.stringify(data));
                            }
                            break;
                        case 'schedule':
                            if (Array.isArray(data)) {
                                localStorage.setItem('schedule', JSON.stringify(data));
                            }
                            break;
                        case 'prices':
                            if (Array.isArray(data)) {
                                localStorage.setItem('prices', JSON.stringify(data));
                            }
                            break;
                        case 'team':
                            if (Array.isArray(data)) {
                                localStorage.setItem('team', JSON.stringify(data));
                            }
                            break;
                        case 'gallery':
                            if (Array.isArray(data)) {
                                localStorage.setItem('gallery', JSON.stringify(data));
                            }
                            break;
                        case 'telegram':
                            if (data.telegram_bot_token) {
                                localStorage.setItem('telegram_bot_token', data.telegram_bot_token);
                            }
                            if (data.telegram_chat_id) {
                                localStorage.setItem('telegram_chat_id', data.telegram_chat_id);
                            }
                            break;
                    }
                    loadAllData();
                }
                
                closeModal();
                showAlert('✅ Данные обновлены из JSON!', 'success');
                
            } catch (error) {
                showAlert('❌ Ошибка в формате JSON: ' + error.message, 'danger');
            }
        }
        
        // ===== ДЕМО ДАННЫЕ =====
        function loadDemoData() {
            if (!confirm('Загрузить полные демонстрационные данные? Существующие данные будут перезаписаны.')) {
                return;
            }
            
            const demoData = {
                studio_data: {
                    name: "Первый ритм Ленинского",
                    heroTitle: "Танцуют <span class='highlight'>все</span> возрасты!",
                    heroSubtitle: "Профессиональная студия танцев в Иркутске для детей от 3 лет и взрослых до 65+. Пробное занятие всего за 300₽. Запишись прямо сейчас!",
                    stats: {
                        directions: "15+",
                        students: "500+",
                        experience: "12+",
                        age: "3-65"
                    },
                    phone: "+7 (904) 123-31-75",
                    address: "г. Иркутск, ул. 1-й Ленинский квартал, д. 1",
                    hours: "Ежедневно с 8:00 до 22:00",
                    trialPrice: "300₽",
                    description: "Профессиональная студия танцев для всех возрастов в Иркутске.",
                    copyright: "© 2024 Студия танцев 'Первый ритм Ленинского'. Все права защищены."
                },
                directions: [
                   {
  "age_groups": [
    {
      "name": "Детские направления (3-7 лет)",
      "directions": [
        {
          "id": "baby-dance",
          "name": "Танец-игра / Ритмика",
          "schedule": "Занятия по понедельникам и средам в 17:00",
          "price": "Пробное занятие: 300₽"
        },
        {
          "id": "baby-classic",
          "name": "Азбука классического танца",
          "schedule": "Занятия по вторникам и четвергам в 17:30",
          "price": "Пробное занятие: 300₽"
        },
        {
          "id": "baby-mult",
          "name": "Беби-мульт-денс",
          "schedule": "Занятия по пятницам в 17:00 и субботам в 10:00",
          "price": "Пробное занятие: 300₽"
        }
      ]
    },
    {
      "name": "Младшие школьники (8-12 лет)",
      "directions": [
        {
          "id": "kids-classic",
          "name": "Классическая хореография",
          "schedule": "Занятия по понедельникам, средам и пятницам в 16:00",
          "price": "Абонемент: 2800₽/мес"
        },
        {
          "id": "kids-modern",
          "name": "Современный танец",
          "schedule": "Хип-хоп, джаз-модерн. Занятия по вторникам и четвергам в 17:00",
          "price": "Абонемент: 2800₽/мес"
        },
        {
          "id": "kids-estrade",
          "name": "Эстрадный танец",
          "schedule": "Занятия по субботам в 12:00",
          "price": "Абонемент: 2800₽/мес"
        }
      ]
    },
    {
      "name": "Подростки (13-16 лет)",
      "directions": [
        {
          "id": "teens-contemporary",
          "name": "Современная хореография (Contemporary)",
          "schedule": "Занятия по понедельникам и средам в 18:00",
          "price": "Абонемент: 3200₽/мес"
        },
        {
          "id": "teens-hiphop-old",
          "name": "Хип-хоп (Old School)",
          "schedule": "Breaking, Popping, Locking. Занятия по вторникам в 18:30",
          "price": "Абонемент: 3200₽/мес"
        },
        {
          "id": "teens-hiphop-new",
          "name": "Хип-хоп (New Style)",
          "schedule": "Vogue, Dancehall, House Dance, Afro House. Занятия по четвергам в 18:30",
          "price": "Абонемент: 3200₽/мес"
        }
      ]
    },
    {
      "name": "Взрослые направления (17+ лет)",
      "directions": [
        {
          "id": "adult-contemporary",
          "name": "Танец для души (Contemporary, Modern Dance)",
          "schedule": "Занятия по понедельникам и четвергам в 19:30",
          "price": "Абонемент: 3200₽/мес"
        },
        {
          "id": "adult-hiphop",
          "name": "Хип-хоп для взрослых",
          "schedule": "Занятия по средам в 19:00 и субботам в 15:00",
          "price": "Абонемент: 3200₽/мес"
        },
        {
          "id": "adult-heels",
          "name": "High Heels / Lady Dance",
          "schedule": "Занятия по вторникам в 20:00 и пятницам в 19:00",
          "price": "Абонемент: 3200₽/мес"
        }
      ]
    },
    {
      "name": "Взрослые направления (25+ лет)",
      "directions": [
        {
          "id": "adult25-lady",
          "name": "Lady Dance, High Heels",
          "schedule": "Занятия по понедельникам в 20:00 и субботам в 13:00",
          "price": "Абонемент: 3200₽/мес"
        },
        {
          "id": "adult25-contemporary",
          "name": "Contemporary, Modern Dance",
          "schedule": "Занятия по средам в 20:00",
          "price": "Абонемент: 3200₽/мес"
        },
        {
          "id": "adult25-ballet",
          "name": "Body Ballet для взрослых",
          "schedule": "Занятия по вторникам и четвергам в 19:00",
          "price": "Абонемент: 3200₽/мес"
        }
      ]
    },
    {
      "name": "Взрослые направления (45+ лет)",
      "directions": [
        {
          "id": "adult45-lady",
          "name": "Lady Dance для женщин 45+",
          "schedule": "Занятия по понедельникам и средам в 10:00",
          "price": "Абонемент: 3000₽/мес"
        },
        {
          "id": "adult45-ballet",
          "name": "Body Ballet 45+",
          "schedule": "Занятия по вторникам и пятницам в 10:00",
          "price": "Абонемент: 3000₽/мес"
        },
        {
          "id": "adult45-ballroom",
          "name": "Социальные танцы",
          "schedule": "Занятия по четвергам в 10:00 и субботам в 11:00",
          "price": "Абонемент: 3000₽/мес"
        }
      ]
    }
  ],
  "special_programs": [
    {
      "name": "Воскресная растяжка",
      "description": "Для всех возрастов",
      "schedule": "Воскресенье в 11:00",
      "price": "Разовое: 500₽"
    },
    {
      "name": "Семейная растяжка «Мама и ребёнок»",
      "description": "",
      "schedule": "Суббота в 10:30",
      "price": "Семейный абонемент: 3500₽"
    },
    {
      "name": "Утренняя йога и фитнес",
      "description": "",
      "schedule": "Понедельник, среда, пятница в 8:00",
      "price": "Абонемент: 2500₽/мес"
    }
  ]
}
                ],
                schedule: [
                    { day: "Пн", time: "17:00", direction: "Танец-игра", age: "3-7 лет", duration: "60 мин" },
                    { day: "Вт", time: "17:30", direction: "Хип-хоп", age: "13-25 лет", duration: "90 мин" }
                ],
                prices: [
                    {
                        title: "ПРОБНОЕ ЗАНЯТИЕ",
                        price: "300₽",
                        period: "1 занятие",
                        features: ["Первое занятие", "Консультация педагога", "Подбор направления"],
                        buttonText: "Записаться",
                        telegramData: "trial"
                    },
                    {
                        title: "ДЕТСКИЙ АБОНЕМЕНТ",
                        price: "2 800₽",
                        period: "8 занятий",
                        features: ["Абонемент на 30 дней", "Любое направление", "Заморозка на 7 дней"],
                        buttonText: "Купить",
                        telegramData: "child_abonement"
                    }
                ],
                team: [
                    { initials: "АП", name: "Анна Петрова", role: "Главный хореограф", experience: "14 лет", bio: "Выпускница Московской академии хореографии" },
                    { initials: "МК", name: "Михаил Козлов", role: "Преподаватель хип-хопа", experience: "6 лет", bio: "Участник российских хип-хоп баттлов" }
                ],
                gallery: [
                    {
                        image: "https://images.unsplash.com/photo-1518834103328-93d45986dce1?auto=format&fit=crop&w=800&q=80",
                        title: "Основной зал",
                        description: "Профессиональное покрытие, зеркала",
                        category: "Зал"
                    }
                ],
                telegram_bot_token: "",
                telegram_chat_id: "",
                applications: []
            };
            
            importDataFromObject(demoData);
        }
        
        function loadPartialDemoData() {
            if (!confirm('Загрузить частичные демонстрационные данные (без перезаписи существующих)?')) {
                return;
            }
            
            // Загружаем только пустые разделы
            const sections = ['directions', 'schedule', 'prices', 'team', 'gallery'];
            
            sections.forEach(section => {
                const currentData = JSON.parse(localStorage.getItem(section) || '[]');
                if (currentData.length === 0) {
                    switch(section) {
                        case 'directions':
                            loadDemoDirections();
                            break;
                        case 'schedule':
                            loadDemoSchedule();
                            break;
                        case 'prices':
                            loadDemoPrices();
                            break;
                        case 'team':
                            loadDemoTeam();
                            break;
                        case 'gallery':
                            loadDemoGallery();
                            break;
                    }
                }
            });
            
            showAlert('✅ Частичные демо-данные загружены в пустые разделы', 'success');
        }
        
        // ===== УТИЛИТЫ =====
        function getDayName(day) {
            const days = {
                'Пн': 'Понедельник',
                'Вт': 'Вторник',
                'Ср': 'Среда',
                'Чт': 'Четверг',
                'Пт': 'Пятница',
                'Сб': 'Суббота',
                'Вс': 'Воскресенье'
            };
            return days[day] || day;
        }
        
        function deleteItem(type, index) {
            const confirmMessage = {
                'directions': 'Удалить это направление?',
                'schedule': 'Удалить это занятие из расписания?',
                'prices': 'Удалить этот тариф?',
                'team': 'Удалить этого преподавателя?',
                'gallery': 'Удалить это изображение из галереи?'
            }[type] || 'Удалить этот элемент?';
            
            if (confirm(confirmMessage)) {
                const data = JSON.parse(localStorage.getItem(type) || '[]');
                data.splice(index, 1);
                localStorage.setItem(type, JSON.stringify(data));
                
                // Обновляем соответствующий список
                switch(type) {
                    case 'directions':
                        renderDirectionsList();
                        break;
                    case 'schedule':
                        renderScheduleList();
                        break;
                    case 'prices':
                        renderPricesList();
                        break;
                    case 'team':
                        renderTeamList();
                        break;
                    case 'gallery':
                        renderGalleryList();
                        break;
                }
                
                showAlert('✅ Элемент удален', 'success');
                updateDataStatus();
            }
        }
        
        function loadAllData() {
            loadStudioData();
            renderDirectionsList();
            renderScheduleList();
            renderPricesList();
            renderTeamList();
            renderGalleryList();
            loadApplications();
            updateDataStatus();
        }
        
        function saveAllData() {
            saveStudioData();
            showAlert('✅ Все данные сохранены!', 'success');
            updateDataStatus();
        }
        
        function saveAllDataSilently() {
            // Автосохранение без уведомления
            const studioData = {
                name: document.getElementById('studioName').value.trim(),
                heroTitle: document.getElementById('heroTitle').value.trim(),
                heroSubtitle: document.getElementById('heroSubtitle').value.trim(),
                stats: {
                    directions: document.getElementById('statDirections').value.trim(),
                    students: document.getElementById('statStudents').value.trim(),
                    experience: document.getElementById('statExperience').value.trim(),
                    age: document.getElementById('statAge').value.trim()
                },
                phone: document.getElementById('studioPhone').value.trim(),
                address: document.getElementById('studioAddress').value.trim(),
                hours: document.getElementById('studioHours').value.trim(),
                trialPrice: document.getElementById('trialPrice').value.trim(),
                description: document.getElementById('footerDescription').value.trim(),
                copyright: document.getElementById('copyright').value.trim()
            };
            
            localStorage.setItem('studio_data', JSON.stringify(studioData));
            console.log('Автосохранение выполнено:', new Date().toLocaleTimeString());
        }
        
        function clearAllData() {
            if (confirm('ВНИМАНИЕ! Это удалит ВСЕ данные без возможности восстановления. Продолжить?')) {
                localStorage.clear();
                loadAllData();
                showAlert('🗑️ Все данные удалены', 'success');
            }
        }
        
        function updateDashboard() {
            const directions = JSON.parse(localStorage.getItem('directions') || '[]');
            const schedule = JSON.parse(localStorage.getItem('schedule') || '[]');
            const prices = JSON.parse(localStorage.getItem('prices') || '[]');
            const team = JSON.parse(localStorage.getItem('team') || '[]');
            const gallery = JSON.parse(localStorage.getItem('gallery') || '[]');
            
            document.getElementById('statDirectionsCount').textContent = directions.length;
            document.getElementById('statScheduleCount').textContent = schedule.length;
            document.getElementById('statPricesCount').textContent = prices.length;
            document.getElementById('statTeamCount').textContent = team.length;
            document.getElementById('statGalleryCount').textContent = gallery.length;
        }
        
        function updateDataStatus() {
            // Обновляем счетчики в боковом меню
            const directions = JSON.parse(localStorage.getItem('directions') || '[]');
            const schedule = JSON.parse(localStorage.getItem('schedule') || '[]');
            const prices = JSON.parse(localStorage.getItem('prices') || '[]');
            const team = JSON.parse(localStorage.getItem('team') || '[]');
            const gallery = JSON.parse(localStorage.getItem('gallery') || '[]');
            const applications = JSON.parse(localStorage.getItem('applications') || '[]');
            
            // Обновляем бейджи в табах
            document.getElementById('tabDirectionsBadge').textContent = directions.length;
            document.getElementById('tabScheduleBadge').textContent = schedule.length;
            document.getElementById('tabPricesBadge').textContent = prices.length;
            document.getElementById('tabTeamBadge').textContent = team.length;
            document.getElementById('tabGalleryBadge').textContent = gallery.length;
            
            // Обновляем счетчики в менеджере данных
            document.getElementById('directionsDataCount').textContent = directions.length;
            document.getElementById('scheduleDataCount').textContent = schedule.length;
            document.getElementById('pricesDataCount').textContent = prices.length;
            document.getElementById('teamDataCount').textContent = team.length;
            document.getElementById('galleryDataCount').textContent = gallery.length;
            document.getElementById('applicationsDataCount').textContent = applications.length;
            
            // Обновляем статус студии
            const studioData = JSON.parse(localStorage.getItem('studio_data') || '{}');
            document.getElementById('studioDataStatus').textContent = studioData.name ? '✓' : '✗';
            document.getElementById('studioDataStatus').className = studioData.name ? 'badge badge-primary' : 'badge badge-danger';
            
            // Обновляем статус Telegram
            const hasTelegram = localStorage.getItem('telegram_bot_token') && localStorage.getItem('telegram_chat_id');
            document.getElementById('telegramDataStatus').textContent = hasTelegram ? '✓' : '✗';
            document.getElementById('telegramDataStatus').className = hasTelegram ? 'badge badge-success' : 'badge badge-warning';
            
            // Обновляем дашборд
            updateDashboard();
        }
        
        function loadDataStatus() {
            const container = document.getElementById('dataStatusList');
            
            const studioData = JSON.parse(localStorage.getItem('studio_data') || '{}');
            const directions = JSON.parse(localStorage.getItem('directions') || '[]');
            const schedule = JSON.parse(localStorage.getItem('schedule') || '[]');
            const prices = JSON.parse(localStorage.getItem('prices') || '[]');
            const team = JSON.parse(localStorage.getItem('team') || '[]');
            const gallery = JSON.parse(localStorage.getItem('gallery') || '[]');
            const hasTelegram = localStorage.getItem('telegram_bot_token') && localStorage.getItem('telegram_chat_id');
            
            container.innerHTML = `
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span>Информация студии:</span>
                    <span class="${studioData.name ? 'badge badge-success' : 'badge badge-danger'}">${studioData.name ? '✓ Заполнена' : '✗ Не заполнена'}</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span>Направления:</span>
                    <span class="${directions.length > 0 ? 'badge badge-success' : 'badge badge-warning'}">${directions.length} шт.</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span>Расписание:</span>
                    <span class="${schedule.length > 0 ? 'badge badge-success' : 'badge badge-warning'}">${schedule.length} занятий</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span>Цены:</span>
                    <span class="${prices.length > 0 ? 'badge badge-success' : 'badge badge-warning'}">${prices.length} тарифов</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span>Команда:</span>
                    <span class="${team.length > 0 ? 'badge badge-success' : 'badge badge-warning'}">${team.length} преподавателей</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span>Галерея:</span>
                    <span class="${gallery.length > 0 ? 'badge badge-success' : 'badge badge-warning'}">${gallery.length} фото</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span>Telegram бот:</span>
                    <span class="${hasTelegram ? 'badge badge-success' : 'badge badge-warning'}">${hasTelegram ? '✓ Настроен' : '✗ Не настроен'}</span>
                </div>
            `;
        }
        
        function validateAllData() {
            const errors = [];
            const studioData = JSON.parse(localStorage.getItem('studio_data') || '{}');
            
            if (!studioData.name) errors.push('Не заполнено название студии');
            if (!studioData.phone) errors.push('Не заполнен телефон');
            if (!studioData.address) errors.push('Не заполнен адрес');
            
            if (errors.length > 0) {
                showAlert(`⚠️ Обнаружены ошибки:<br>${errors.join('<br>')}`, 'danger');
            } else {
                showAlert('✅ Все данные корректны!', 'success');
            }
        }
        
        function showAlert(message, type = 'info', duration = 5000) {
            const alertContainer = document.getElementById('globalAlert');
            const alertId = 'alert-' + Date.now();
            
            alertContainer.innerHTML = `
                <div class="alert alert-${type}" id="${alertId}">
                    ${message}
                    <button class="alert-close" onclick="document.getElementById('${alertId}').remove()">×</button>
                </div>
            `;
            
            if (duration > 0) {
                setTimeout(() => {
                    const alertElement = document.getElementById(alertId);
                    if (alertElement) {
                        alertElement.remove();
                    }
                }, duration);
            }
        }
        
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }
        
        function closeModal() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.style.display = 'none';
            });
        }
        
        // Экспортируем функции в глобальную область видимости
        window.showSection = showSection;
        window.saveStudioData = saveStudioData;
        window.loadStudioData = loadStudioData;
        window.editStudioJson = editStudioJson;
        window.addDirection = addDirection;
        window.clearDirectionForm = clearDirectionForm;
        window.editDirection = editDirection;
        window.duplicateDirection = duplicateDirection;
        window.showDirectionsJson = showDirectionsJson;
        window.loadDemoDirections = loadDemoDirections;
        window.addSchedule = addSchedule;
        window.clearScheduleForm = clearScheduleForm;
        window.editSchedule = editSchedule;
        window.showScheduleJson = showScheduleJson;
        window.loadDemoSchedule = loadDemoSchedule;
        window.addPrice = addPrice;
        window.clearPriceForm = clearPriceForm;
        window.editPrice = editPrice;
        window.duplicatePrice = duplicatePrice;
        window.showPricesJson = showPricesJson;
        window.loadDemoPrices = loadDemoPrices;
        window.addTeamMember = addTeamMember;
        window.clearTeamForm = clearTeamForm;
        window.editTeamMember = editTeamMember;
        window.showTeamJson = showTeamJson;
        window.loadDemoTeam = loadDemoTeam;
        window.addGalleryItem = addGalleryItem;
        window.clearGalleryForm = clearGalleryForm;
        window.editGalleryItem = editGalleryItem;
        window.showGalleryJson = showGalleryJson;
        window.loadDemoGallery = loadDemoGallery;
        window.saveTelegramConfig = saveTelegramConfig;
        window.testTelegramConnection = testTelegramConnection;
        window.showTelegramJson = showTelegramJson;
        window.loadApplications = loadApplications;
        window.deleteApplication = deleteApplication;
        window.clearApplications = clearApplications;
        window.showDataSection = showDataSection;
        window.refreshDataManager = refreshDataManager;
        window.exportData = exportData;
        window.importData = importData;
        window.loadCurrentJson = loadCurrentJson;
        window.applyJsonChanges = applyJsonChanges;
        window.showJsonEditor = showJsonEditor;
        window.applyJsonChangesFromModal = applyJsonChangesFromModal;
        window.loadDemoData = loadDemoData;
        window.loadPartialDemoData = loadPartialDemoData;
        window.deleteItem = deleteItem;
        window.saveAllData = saveAllData;
        window.clearAllData = clearAllData;
        window.validateAllData = validateAllData;
        window.openModal = openModal;
        window.closeModal = closeModal;
    </script>
</body>
</html>
